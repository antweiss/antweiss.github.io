<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="One Man&#39;s Singularity">


    <meta property="twitter:site" content="@antweiss">

<meta property="og:site_name" content="one man&#39;s singularity" />
<meta property="og:locale" content="en-us" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://antweiss.com/blog/extending-envoy-with-wasm-and-rust/" />
<meta property="og:title" content="Extending Envoy With Wasm and Rust" />
<meta property="twitter:title" content="Extending Envoy With Wasm and Rust">

    <meta property="og:image" content="https://antweiss.com/img/horns-bw.png">
    <meta property="twitter:card" content="summary">
    <meta property="twitter:image" content="https://antweiss.com/img/horns-bw.png">

<meta property="og:description" content="">
<meta property="twitter:description" content="">

<title>


     one man&#39;s singularity - Extending Envoy With Wasm and Rust 

</title>
<link rel="canonical" href="https://antweiss.com/blog/extending-envoy-with-wasm-and-rust/">


<style media="screen">
  @font-face {
  font-family: 'Nexa Bold';
  src: url('https://antweiss.com/fonts/Nexa Bold.otf');
}

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
img[src$='#floatleft']
{
	float:left;
  margin-right: 1em;
}

img[src$='#floatright']
{
	float:right;
       //etc. etc.
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section, div.column {
  display: block;
}
body {
  line-height: 1;
}
ol, ul {
  list-style: none;
}
blockquote, q {
  quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

*,
*:before,
*:after {
  box-sizing: border-box;
}
a,
a:visited,
a:focus,
a:active {
  text-decoration: underline;
}
html {
  height: 100%;
  font-size: 16px;
}
body {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
  width: 100%;
  min-height: 100%;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  color: #111111;
  line-height: 1.6;
  text-rendering: optimizeLegibility !important;
}
.icon {
  text-rendering: geometricPrecision !important;
}
section {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
div.column {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
.container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  width: 100%;
}
div.header .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.header .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.header .container .logo {
  
  max-width: 100px;
  
  margin-left: 1em;
  margin-right: 1em;
}
div.header .a {
  text-decoration: none;
}
div.header .name {
  padding-top: 20px;
  font-size: 28px;
  font-family: 'Nexa Bold', 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  
  text-transform: uppercase;
  
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
}
div.header nav {
  margin-bottom: 16px;
}
div.header nav ul {
  list-style: none;
  text-align: center;
  display: -webkit-inline-flex;
  display: -moz-inline-flex;
  display: -ms-inline-flexbox;
  display: -ms-inline-flex;
  display: inline-flex;
}
div.header nav ul li {
  margin-left: 6px;
  margin-right: 6px;
}
div.header nav ul li:first-child {
  margin-left: 0;
}
div.header nav ul li:last-child {
  margin-right: 0;
}
div.header nav ul a {
  color: #555555;
  font-weight: 400;
  font-size: 14px;
  text-transform: uppercase;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}

div.footer .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  flex-direction: column-reverse;
  width: 100%;
  text-align: center;
}
div.footer .container a {
  font-size: 14px;
  margin-left: 6px;
  margin-right: 6px;
  opacity: 0.6;
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.footer .container a:first-child {
  margin-left: 0;
}
div.footer .container a:last-child {
  margin-right: 0;
}
div.footer .container a:hover {
  opacity: 0.8;
}
div.footer .container a .icon {
  width: 16px;
  height: 16px;
}
div.footer .container .copyright {
  flex-grow: 0.5;
  text-align: start;
}
div.footer .container .icons {
  flex-grow: 0.5;
  text-align: end;
}
div.main .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
}
div.main .content {
  color: #111111;
  font-size: 16px;
}
div.main .content .title-container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: space-between;
  -moz-justify-content: space-between;
  -ms-justify-content: space-between;
  justify-content: space-between;
}
div.main .content .posts {
  
  
}
div.main .content .page-heading {
  font-size: 20px;
  font-weight: 700;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  margin-bottom: 16px;
}
div.main .content .front-matter .page-heading {
  margin-bottom: 0;
}
div.main .content .front-matter .meta {
  font-size: 14px;
  color: #666666;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  margin-bottom: 32px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
  display: none;
}
div.main .content .front-matter .middot:before {
  font-size: 6px;
  margin: 0 6px;
  vertical-align: middle;
  content: "•";
}
div.main .content .front-matter .tags ul {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .content .front-matter .tags ul li {
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.main .content .front-matter .tags ul li:hover {
  opacity: 0.7;
}
div.main .content .front-matter .tags ul li a {
  color: #666666;
}

div.main .container.f04 {
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.main .container.f04 .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .container.f04 .content .num {
  margin: 30px 0px 30px 0;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  font-size: 50px;
}
div.main .container.f04 .content .detail {
  margin-bottom: 40px;
}
div.main .container .content .groupby {
  margin-top: 1em;
  padding-left: 0.5em;
}
div.main .container .content .post-item {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  display: list-item;
  list-style: disc inside;
}
div.main .container .content .post-item .meta {
  font-size: 14px;
  color: #666666;
  display: none;
  min-width: 100px;
}
div.main .container .content .see-more {
  font-style: italic;
  float: right;
  font-size: 0.9em;
  margin-top: 2em;
  color: #313537;
}
div.main .container .content .see-more:hover {
  color: #666;
}
section {
  padding: 0 16px;
}
div.column {
  padding: 0 16px;
}
div.header {
  padding-top: 10px;
}
div.header-home {
  padding-top: 36px;
  max-width: 80%;
}
div.main {
  padding-top: 32px;
}
div.main .container .content .post-item .meta {
    display: block;
}
div.main .container .content .post-item {
    display: flex;
    list-style: none;
}
a {
/*  color: #428bca;*/
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
a:hover {
  color: yellow;
}
img {
  max-width: 50%;
}
div.main .content {
    width: 100%;
}
div.main .content .markdown {
  font-size: 1.1em;
  line-height: 1.75em;
  color: #313537;
  font-family: serif;
  font-weight: 300;
}
div.main .content .markdown h1,
div.main .content .markdown h2,
div.main .content .markdown h3,
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 22px;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  font-weight: 700;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
/*  color: #333333; */
  text-transform: none;
  margin-top: 1.75rem;
}
div.main .content .markdown h1 {
  font-size: 1.75rem;
  margin-bottom: 2rem;
}
div.main .content .markdown h2 {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
}
div.main .content .markdown h3 {
  font-size: 1em;
  margin-bottom: 1rem;
}
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 1rem;
  margin-bottom: 1rem;
  letter-spacing: none;
}
div.main .content .markdown code,
div.main .content .markdown pre {
  font-family: 'Menlo', monospace;
  font-size: 0.98rem;
/*  background-color: #f7f7f7; */
}
div.main .content .markdown code {
  /* enclosed by single backtick (`) */
  padding: .15em .5em;
  border-radius: 2px;
}
div.main .content .markdown pre {
  /* Hugo specific: consider using the 'highlight' shortcode */
  display: block;
  margin-top: 1rem;
  margin-bottom: 1rem;
  padding: 0;
  line-height: 1.5em;
  white-space: pre;
  word-break: break-all;
  word-wrap: break-word;
}
div.main .content .markdown pre code {
  /* enclosed by 4 backticks (````) */
  padding: 0;
  font-size: 0.9rem;
}
div.main .content .markdown a code {
  color: #428bca !important;
}
div.main .content .markdown a code:hover {
  text-decoration: underline;
}
div.main .content .markdown p {
  
  text-align: justify;
  
  margin-top: 0;
  margin-bottom: 1em;
}
div.main .content .markdown ul,
div.main .content .markdown ol,
div.main .content .markdown dl {
  text-align: justify;
  margin-top: 1rem;
  margin-bottom: 2rem;
}
div.main .content .markdown dt {
  font-weight: bold;
}
div.main .content .markdown dd {
  margin-bottom: .5rem;
}
div.main .content .markdown ul {
  list-style-type: disc;
  list-style-position: outside;
  margin-bottom: 1.25rem;
}
div.main .content .markdown ol {
  list-style-type: decimal;
  margin-bottom: 1.25rem;
}
div.main .content .markdown li {
  margin-left: 2em;
}
div.main .content .markdown em {
  font-style: italic;
}
div.main .content .markdown strong {
  font-weight: 700;
}
div.main .content .markdown hr {
  position: relative;
  margin: 1.75rem 0;
  border: 0;
  border-top: 1px solid #808080;
  border-top: 1px solid #999999;
}
div.main .content .markdown abbr {
  font-size: 0.85rem;
  font-weight: bold;
  color: #666666;
  text-transform: uppercase;
}
div.main .content .markdown abbr[title] {
  cursor: help;
  border-bottom: 1px dotted #808080;
}
div.main .content .markdown blockquote {
  padding: .5rem 1rem;
  margin: .8rem 0;
  color: #7a7a7a;
  border-left: .25rem solid #e5e5e5;
}
div.main .content .markdown blockquote p:last-child {
  margin-bottom: 0;
}
div.main .content .markdown figure {
  width: 100%;
  background: #fff;
  margin-bottom: 1em;
}
div.main .content .markdown figure img {
  width: 100%;
  height: auto;
  max-width: 50%;
  display: block;
  position: static;
  margin: auto;
}
div.main .content .markdown table {
  margin-bottom: 1rem;
  width: 100%;
  border: 1px solid #e5e5e5;
  border-collapse: collapse;
}
div.main .content .markdown td,
div.main .content .markdown th {
  padding: .25rem .5rem;
  border: 1px solid #e5e5e5;
}
div.main .content .markdown tbody tr:nth-child(odd) td,
div.main .content .markdown tbody tr:nth-child(odd) th {
  /* background-color: #f7f7f7; */
}
div.main .content .markdown .footnotes ol {
  list-style-type: decimal;
  margin-left: 16px;
}
div.main .content .markdown .footnotes li {
  list-style-type: unset;
}
div.main .content .markdown .footnote-ref {
  font-size: 0.7em;
}
div.main .content .navigation {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  padding: 2em;
}
div.main .content .navigation div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  margin-top: 1em;
}
div.main .content .navigation .icon {
  width: 16px;
  height: 16px;
}
div.main .content .navigation a {
  width: 250px;
  margin: 0 1em;
  text-align: center;
  font-style: italic;
  color: #313537;
}
div.main .content .share, div.main .content .share div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  justify-content: center;
}
div.main .content .share {
  /* background-color: rgba(152, 152, 152, 0.07); */
  padding: 1em 0;
}
div.main .content .share a {
  margin: 0 6px;
}
kbd {
  padding: 0.1em 0.6em;
  border: 1px solid #ccc;
  font-size: 11px;
  font-family: Arial,Helvetica,sans-serif;
  /* background-color: #f7f7f7; */
  color: #333;
  -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -moz-border-radius: 3px;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  display: inline-block;
  margin: 0 0.1em;
  text-shadow: 0 1px 0 #fff;
  line-height: 1.4;
  white-space: nowrap;
}

/* Fonts */


.wf-raleway-n4-active body, 
.wf-raleway-n4-active div.header nav ul a,
.wf-raleway-n7-active div.main .content .page-heading,
.wf-raleway-n2-active div.main .container.f04 .content .num,
.wf-raleway-n7-active div.main .content .markdown h1,
.wf-raleway-n7-active div.main .content .markdown h2,
.wf-raleway-n7-active div.main .content .markdown h3,
.wf-raleway-n7-active div.main .content .markdown h4,
.wf-raleway-n7-active div.main .content .markdown h5,
.wf-raleway-n7-active div.main .content .markdown h6 {
      font-family: 'Raleway';
}

.wf-merriweather-n3-active div.main .content .markdown {
      font-family: 'Merriweather';
}

.wf-ubuntu-mono-n4-active div.main .content .markdown code,
.wf-ubuntu-mono-n4-active div.main .content .markdown pre {
      font-family: 'Ubuntu Mono';
}


</style>
<style media="(min-width: 600px)">
  body {
-webkit-justify-content: center;
-moz-justify-content: center;
-ms-justify-content: center;
justify-content: center;
}
.non-narrow.zero-top-spacing {
padding-top: 0 !important;
}
section {
padding: 0 16px;
margin-left: 100px;
margin-right: 100px;

max-width: 750px;

}
div.column {
padding: 0 16px;

max-width: 750px;

}
div.header {
background-color: transparent;
}
div.header .container {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.header .container .logo {
margin: 0;
margin-right: 1em;
}
div.header-home .container .logo {
max-width: 216px;
margin-left: 24px;
margin-right: 1em;
}
div.header-home .name-home {
padding-top: 30px;
font-size: 40px;
}
div.header-home nav ul a {
font-size: 18px;
}
div.header .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.header .name {
color: #333333;
}
div.header nav {
font-size: 14px;
margin-bottom: 0;
}
div.header nav ul {
text-align: left;
}
div.header nav ul a {
color: #666666;
}
div.header nav ul a:hover {
color: #333333;
}
div.footer {
background-color: transparent;
}
div.footer .container {
flex-direction: row;
}
div.footer .container a {
margin-left: 3px;
margin-right: 3px;
color: #666666;
}
div.footer .container a:hover {
color: #333333;
}
div.footer .container a .icon {
font-size: 18px;
}
div.footer .container a .icon.larger {
font-size: 20px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
display: initial;
}
div.main .container.f04 {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.main .container.f04 .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.main .container.f04 .content .num {
margin: 0 0 10px 0;
font-size: 32px;
}
div.main .container.f04 .content .detail {
margin-bottom: 30px;
}
.container {
padding: 0 30px;
}
div.header {
padding-top: 60px;
padding-bottom: 60px;
}
div.footer {
padding-top: 60px;
padding-bottom: 60px;
}
div.main {
padding-top: 0;
}
div.main .content {
  
  font-size: 16px;
  
}
div.main .container .content .post-item {
display: flex;
list-style: none;
padding-left: 1.5em;
}
div.main .container .content .post-item .meta {
display: block;
}
div.main .content .markdown blockquote {
padding-right: 5rem;
padding-left: 1.25rem;
}
div.main .content .navigation {
-webkit-flex-direction: row;
-moz-flex-direction: row;
-ms-flex-direction: row;
flex-direction: row;
}
div.main .content .navigation div {
margin-top: 0em;
}

</style>
<style media="(min-width: 769px)">
  div.main .content .markdown figure {
width: 110%;
margin-left: -4%;
}
div.main .content .markdown img {
max-width: 110%;
width: 110%;
margin-left: -4%;
}
div.main .content .markdown pre {
width: 110%;
margin-left: -4%;
}

</style>

<noscript>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700" rel="stylesheet">
</noscript>


  <style type="text/css" media="screen">
    .hljs{display:block;background:white;padding:0.5em;color:#333333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-string,.hljs-variable,.hljs-template-variable,.hljs-strong,.hljs-emphasis,.hljs-quote{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-literal,.hljs-symbol,.hljs-bullet,.hljs-attribute{color:#0086b3}.hljs-section,.hljs-name{color:#63a35c}.hljs-tag{color:#333333}.hljs-title,.hljs-attr,.hljs-selector-id,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}
  </style>



  <style type="text/css" media="screen">
    .progressive{overflow:hidden;position:relative;background:#efefef}.progressive__img{width:100%;height:100%;transform:translateZ(0)}.progressive--not-loaded{filter:blur(30px)}.progressive--is-loaded{filter:blur(20px);animation:a .5s both}@keyframes a{0%{filter:blur(20px)}to{filter:blur(0)}}

  </style>



  <style type="text/css" media="screen">
    /*!
 * Social Share Kit v1.0.7 (http://socialsharekit.com)
 * Copyright 2015 Social Share Kit / Kaspars Sprogis.
 * Licensed under Creative Commons Attribution-NonCommercial 3.0 license:
 * https://github.com/darklow/social-share-kit/blob/master/LICENSE
 * ---
 */@font-face{font-family:'social-share-kit';src:url('https://antweiss.com/fonts/social-share-kit.eot');src:url('https://antweiss.com/fonts/social-share-kit.eot?#iefix') format('embedded-opentype'),url('https://antweiss.com/fonts/social-share-kit.woff') format('woff'),url('https://antweiss.com/fonts/social-share-kit.ttf') format('truetype'),url('https://antweiss.com/fonts/social-share-kit.svg#social-share-kit') format('svg');font-weight:normal;font-style:normal}.ssk:before{display:inline-block;font-family:"social-share-kit" !important;font-style:normal !important;font-weight:normal !important;font-variant:normal !important;text-transform:none !important;speak:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.ssk-facebook:before{content:"a";text-indent:4px;margin-right:-4px}.ssk-twitter:before{content:"b"}.ssk-google-plus:before{content:"v"}.ssk-google-plus-old:before{content:"c"}.ssk-email:before{content:"d";top:-1px;position:relative}.ssk-pinterest:before{content:"e"}.ssk-tumblr:before{content:"f"}.ssk-linkedin:before{content:"g"}.ssk-github:before{content:"h"}.ssk-vk:before{content:"i"}.ssk-instagram:before{content:"j"}.ssk-amazon:before{content:"k"}.ssk-skype:before{content:"s"}.ssk-youtube:before{content:"x"}.ssk-vimeo:before{content:"u"}.ssk-ebay:before{content:"p"}.ssk-apple:before{content:"l"}.ssk-behance:before{content:"q"}.ssk-dribble:before{content:"n"}.ssk-android:before{content:"o"}.ssk-whatsapp:before{content:"m"}.ssk-reddit:before{content:"r"}.ssk-reddit2:before{content:"t"}.ssk-link:before{content:"w"}.ssk{background-color:#757575;color:white;display:inline-block;font-size:22px;line-height:1px;margin-right:2px;margin-bottom:2px;padding:7px;text-align:center;text-decoration:none;transition:background-color .1s;-webkit-transition:background-color .1s;-moz-transition:background-color .1s;-ms-transition:background-color .1s;-o-transition:background-color .1s}.ssk:before,.ssk .glyphicon,.ssk .fa{position:relative;font-size:22px;top:0;vertical-align:middle}.ssk.ssk-xs,.ssk-xs>.ssk{padding:4px}.ssk.ssk-xs:before,.ssk-xs>.ssk:before,.ssk.ssk-xs .glyphicon,.ssk-xs>.ssk .glyphicon,.ssk.ssk-xs .fa,.ssk-xs>.ssk .fa{font-size:15px}.ssk.ssk-sm,.ssk-sm>.ssk{padding:5px}.ssk.ssk-sm:before,.ssk-sm>.ssk:before,.ssk.ssk-sm .glyphicon,.ssk-sm>.ssk .glyphicon,.ssk.ssk-sm .fa,.ssk-sm>.ssk .fa{font-size:20px}.ssk.ssk-lg,.ssk-lg>.ssk{padding:9px}.ssk.ssk-lg:before,.ssk-lg>.ssk:before,.ssk.ssk-lg .glyphicon,.ssk-lg>.ssk .glyphicon,.ssk.ssk-lg .fa,.ssk-lg>.ssk .fa{font-size:28px}.ssk:last-child{margin-right:0}.ssk:hover{background-color:#424242}.ssk:hover,.ssk:focus{color:#fff;text-decoration:none}.ssk.ssk-round,.ssk-round .ssk{border-radius:50%}.ssk.ssk-round:before,.ssk-round .ssk:before{text-indent:0;margin-right:0}.ssk.ssk-rounded,.ssk-rounded .ssk{border-radius:15%}.ssk.ssk-icon{color:#757575;padding:2px;font-size:24px}.ssk.ssk-icon,.ssk.ssk-icon:hover{background-color:transparent}.ssk.ssk-icon:hover{color:#424242}.ssk.ssk-icon.ssk-xs,.ssk-xs>.ssk.ssk-icon{font-size:16px}.ssk.ssk-icon.ssk-sm,.ssk-sm>.ssk.ssk-icon{font-size:20px}.ssk.ssk-icon.ssk-lg,.ssk-lg>.ssk.ssk-icon{font-size:28px}.ssk.ssk-text{overflow:hidden;font-size:17px;line-height:normal;padding-right:10px}.ssk.ssk-text:before,.ssk.ssk-text .glyphicon,.ssk.ssk-text .fa{margin:-7px 10px -7px -7px;padding:7px;background-color:rgba(0,0,0,0.15);vertical-align:bottom;text-indent:0}.ssk-block .ssk.ssk-text{display:block;margin-right:0;text-align:left}.ssk.ssk-text.ssk-xs,.ssk-xs>.ssk.ssk-text{font-size:12px;padding-right:6px}.ssk.ssk-text.ssk-xs:before,.ssk-xs>.ssk.ssk-text:before,.ssk.ssk-text.ssk-xs .glyphicon,.ssk-xs>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-xs .fa,.ssk-xs>.ssk.ssk-text .fa{margin:-4px 6px -4px -4px;padding:4px}.ssk.ssk-text.ssk-sm,.ssk-sm>.ssk.ssk-text{font-size:16px;padding-right:7px}.ssk.ssk-text.ssk-sm:before,.ssk-sm>.ssk.ssk-text:before,.ssk.ssk-text.ssk-sm .glyphicon,.ssk-sm>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-sm .fa,.ssk-sm>.ssk.ssk-text .fa{margin:-5px 7px -5px -5px;padding:5px}.ssk.ssk-text.ssk-lg,.ssk-lg>.ssk.ssk-text{font-size:22px;padding-right:13px}.ssk.ssk-text.ssk-lg:before,.ssk-lg>.ssk.ssk-text:before,.ssk.ssk-text.ssk-lg .glyphicon,.ssk-lg>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-lg .fa,.ssk-lg>.ssk.ssk-text .fa{margin:-9px 13px -9px -9px;padding:9px}.ssk-group,.ssk-sticky{font-size:0}.ssk-sticky{top:0;position:fixed;z-index:2000}.ssk-sticky .ssk{transition:padding .1s ease-out;-webkit-transition:padding .1s ease-out;-moz-transition:padding .1s ease-out;-ms-transition:padding .1s ease-out;-o-transition:padding .1s ease-out;margin:0}@media (min-width:768px){.ssk-sticky.ssk-left .ssk,.ssk-sticky.ssk-right .ssk{display:block;clear:both}.ssk-sticky.ssk-left.ssk-center,.ssk-sticky.ssk-right.ssk-center{top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%)}.ssk-sticky.ssk-left{left:0}.ssk-sticky.ssk-left .ssk{float:left}.ssk-sticky.ssk-left .ssk:hover{padding-left:15px}.ssk-sticky.ssk-right{right:0}.ssk-sticky.ssk-right .ssk{float:right}.ssk-sticky.ssk-right .ssk:hover{padding-right:15px}}.ssk-sticky.ssk-bottom{font-size:0;top:auto;bottom:0}.ssk-sticky.ssk-bottom.ssk-center{left:50%;right:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%)}.ssk-sticky.ssk-bottom .ssk{vertical-align:bottom}.ssk-sticky.ssk-bottom .ssk:hover{padding-bottom:15px}.ssk-sticky.ssk-round.ssk-xs .ssk:hover{padding:8px}.ssk-sticky.ssk-round.ssk-sm .ssk:hover{padding:9px}.ssk-sticky.ssk-round .ssk:hover{padding:11px}.ssk-sticky.ssk-round.ssk-lg .ssk:hover{padding:13px}@media (max-width:767px){.ssk-sticky{left:0;right:0;bottom:0;top:auto;width:100%;display:flex !important;flex-direction:row;flex-wrap:nowrap}.ssk-sticky.ssk-sticky-hide-xs{display:none !important}.ssk-sticky .ssk{flex:1;width:auto}.ssk-sticky .ssk .ssk-num{display:none}}.ssk-count{padding-top:20px}.ssk-count .ssk{position:relative}.ssk-count .ssk-num{border-radius:4px;color:#8f8f8f;background-color:rgba(50,50,50,0.03);display:block;font-size:12px;left:0;line-height:20px;position:absolute;right:0;text-align:center;top:-20px}@media (min-width:768px){.ssk-count.ssk-sticky{padding-top:0}.ssk-count.ssk-sticky.ssk-left .ssk-num,.ssk-count.ssk-sticky.ssk-right .ssk-num{top:20%;background-color:transparent}.ssk-count.ssk-sticky.ssk-left .ssk-num{left:100%;margin-left:5px}.ssk-count.ssk-sticky.ssk-right .ssk-num{right:115%;margin-left:-100%;text-align:right}}.ssk-facebook{background-color:#3B5998}.ssk-grayscale>.ssk-facebook{background-color:#757575}.ssk-facebook:hover{background-color:#2d4373}.ssk-facebook:hover{background-color:#2d4373}.ssk-grayscale>.ssk-facebook:hover{background-color:#3B5998}.ssk-facebook.ssk-icon{color:#3B5998}.ssk-facebook.ssk-icon:hover{color:#2d4373}.ssk-facebook.ssk-icon:before{text-indent:0;margin-right:0}.ssk-twitter{background-color:#1DA1F2}.ssk-grayscale>.ssk-twitter{background-color:#757575}.ssk-twitter:hover{background-color:#0c85d0}.ssk-twitter:hover{background-color:#0c85d0}.ssk-grayscale>.ssk-twitter:hover{background-color:#1DA1F2}.ssk-twitter.ssk-icon{color:#1DA1F2}.ssk-twitter.ssk-icon:hover{color:#0c85d0}.ssk-google-plus{background-color:#EA4335}.ssk-grayscale>.ssk-google-plus{background-color:#757575}.ssk-google-plus:hover{background-color:#d62516}.ssk-google-plus:hover{background-color:#d62516}.ssk-grayscale>.ssk-google-plus:hover{background-color:#EA4335}.ssk-google-plus.ssk-icon{color:#EA4335}.ssk-google-plus.ssk-icon:hover{color:#d62516}.ssk-pinterest{background-color:#BD081C}.ssk-grayscale>.ssk-pinterest{background-color:#757575}.ssk-pinterest:hover{background-color:#8c0615}.ssk-pinterest:hover{background-color:#8c0615}.ssk-grayscale>.ssk-pinterest:hover{background-color:#BD081C}.ssk-pinterest.ssk-icon{color:#BD081C}.ssk-pinterest.ssk-icon:hover{color:#8c0615}.ssk-tumblr{background-color:#395773}.ssk-grayscale>.ssk-tumblr{background-color:#757575}.ssk-tumblr:hover{background-color:#283d51}.ssk-tumblr:hover{background-color:#283d51}.ssk-grayscale>.ssk-tumblr:hover{background-color:#395773}.ssk-tumblr.ssk-icon{color:#395773}.ssk-tumblr.ssk-icon:hover{color:#283d51}.ssk-email{background-color:#757575}.ssk-grayscale>.ssk-email{background-color:#757575}.ssk-email:hover{background-color:#5b5b5b}.ssk-email:hover{background-color:#5b5b5b}.ssk-grayscale>.ssk-email:hover{background-color:#757575}.ssk-grayscale>.ssk-email:hover{background-color:#5b5b5b}.ssk-email.ssk-icon{color:#757575}.ssk-email.ssk-icon:hover{color:#5b5b5b}.ssk-vk{background-color:#54769a}.ssk-grayscale>.ssk-vk{background-color:#757575}.ssk-vk:hover{background-color:#425d79}.ssk-vk:hover{background-color:#425d79}.ssk-grayscale>.ssk-vk:hover{background-color:#54769a}.ssk-vk.ssk-icon{color:#54769a}.ssk-vk.ssk-icon:hover{color:#425d79}.ssk-linkedin{background-color:#1c87bd}.ssk-grayscale>.ssk-linkedin{background-color:#757575}.ssk-linkedin:hover{background-color:#156791}.ssk-linkedin:hover{background-color:#156791}.ssk-grayscale>.ssk-linkedin:hover{background-color:#1c87bd}.ssk-linkedin.ssk-icon{color:#1c87bd}.ssk-linkedin.ssk-icon:hover{color:#156791}.ssk-whatsapp{background-color:#34AF23}.ssk-grayscale>.ssk-whatsapp{background-color:#757575}.ssk-whatsapp:hover{background-color:#27851a}.ssk-whatsapp:hover{background-color:#27851a}.ssk-grayscale>.ssk-whatsapp:hover{background-color:#34AF23}.ssk-whatsapp.ssk-icon{color:#34AF23}.ssk-whatsapp.ssk-icon:hover{color:#27851a}.ssk-reddit{background-color:#5f99cf}.ssk-grayscale>.ssk-reddit{background-color:#757575}.ssk-reddit:hover{background-color:#3a80c1}.ssk-reddit:hover{background-color:#3a80c1}.ssk-grayscale>.ssk-reddit:hover{background-color:#5f99cf}.ssk-reddit.ssk-icon{color:#5f99cf}.ssk-reddit.ssk-icon:hover{color:#3a80c1}.ssk-reddit2{background-color:#5f99cf}.ssk-grayscale>.ssk-reddit2{background-color:#757575}.ssk-reddit2:hover{background-color:#3a80c1}.ssk-reddit2:hover{background-color:#3a80c1}.ssk-grayscale>.ssk-reddit2:hover{background-color:#5f99cf}.ssk-reddit2.ssk-icon{color:#5f99cf}.ssk-reddit2.ssk-icon:hover{color:#3a80c1}.ssk-turquoise{background-color:#1abc9c}.ssk-turquoise:hover{background-color:#148f77}.ssk-emerald{background-color:#2ecc71}.ssk-emerald:hover{background-color:#25a25a}.ssk-peter-river{background-color:#3498db}.ssk-peter-river:hover{background-color:#217dbb}.ssk-belize-hole{background-color:#2980b9}.ssk-belize-hole:hover{background-color:#20638f}.ssk-amethyst{background-color:#9b59b6}.ssk-amethyst:hover{background-color:#804399}.ssk-wisteria{background-color:#8e44ad}.ssk-wisteria:hover{background-color:#703688}.ssk-wet-asphalt{background-color:#34495e}.ssk-wet-asphalt:hover{background-color:#222f3d}.ssk-midnight-blue{background-color:#2c3e50}.ssk-midnight-blue:hover{background-color:#1a242f}.ssk-green-sea{background-color:#16a085}.ssk-green-sea:hover{background-color:#107360}.ssk-nephritis{background-color:#27ae60}.ssk-nephritis:hover{background-color:#1e8449}.ssk-sunflower{background-color:#f1c40f}.ssk-sunflower:hover{background-color:#c29d0b}.ssk-orange{background-color:#f39c12}.ssk-orange:hover{background-color:#c87f0a}.ssk-carrot{background-color:#e67e22}.ssk-carrot:hover{background-color:#bf6516}.ssk-pumpkin{background-color:#d35400}.ssk-pumpkin:hover{background-color:#a04000}.ssk-alizarin{background-color:#e74c3c}.ssk-alizarin:hover{background-color:#d62c1a}.ssk-pomegranate{background-color:#c0392b}.ssk-pomegranate:hover{background-color:#962d22}.ssk-clouds{background-color:#cfd9db}.ssk-clouds:hover{background-color:#b1c2c6}.ssk-concrete{background-color:#95a5a6}.ssk-concrete:hover{background-color:#798d8f}.ssk-silver{background-color:#bdc3c7}.ssk-silver:hover{background-color:#a1aab0}.ssk-asbestos{background-color:#7f8c8d}.ssk-asbestos:hover{background-color:#667273}.ssk-dark-gray{background-color:#555}.ssk-dark-gray:hover{background-color:#3b3b3b}.ssk-black{background-color:#333}.ssk-black:hover{background-color:#1a1a1a}
  </style>



  <style type="text/css" media="screen">
    a {
    color: #FFFFFF;
}

a:hover {
    color: #CB57E0;
}

body {
    background-color: #323131;
}

div.main .content .markdown h6 {
    color: #FFFFFF;
}

div.main .content .markdown, div.header .name, div.header nav ul {
    color: #FFFFFF;
    background-color: #323131;

}

div.header-home .container .content a .name h1 {
    text-decoration: none;
}
div .content {
    background-color: #323131;
}

div.header {
    background-color: #323131;
}
div.header nav ul a {
    color: #FFFFFF;
    background-color: #323131;
    text-decoration: none;
}
div.header nav ul a:hover {
  color: #CB57E0;
}

div.main .content .markdown code {
    background-color: #323131;
    color: #FFFFFF;
}

div.main .content .markdown figure {
    background: #323131;
}
div.main .content .markdown pre, div.main .content .markdown pre code {
   /* background-color: #323131;*/
   background-color: rgb(249, 252, 254);
    color: #87a5d2;
}



.hljs, .hljs-subst, .hljs-variable {
    color: #87a5d2;
}

.hljs-type {
    color: #97d28b;
}

.hljs-quote {
    color: #ffcb8d;
}

.hljs-string, .hljs-number, .hljs-selector-id, .hljs-selector-class, .hljs-template-tag, .hljs-deletion {
    color: #96c2d7;
}

.hljs-comment {
    color: #FFFFFF;
}

.hljs-regexp, .hljs-symbol, .hljs-template-variable {
    color: #ffcb8d;
}

.hljs-keyword, .hljs-attribute, .hljs-meta-keyword, .hljs-doctag, .hljs-name {
    color: #97d28b;
}

.hljs-link, .hljs-selector-attr, .hljs-selector-pseudo, .hljs-title, .hljs-section {
    color: #ff8e91;
}

.hljs-built_in, .hljs-bullet, .hljs-code, .hljs-addition {
    color: #97d28b;
}

.ssk {
    background-color: #FFFFFF;
    color: #CB57E0;
    a:hover {
        color: #CB57E0;
    }
}

  </style>





<link rel="shortcut icon"

    href="/img/antweiss.png"

>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-161003981-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>


<body>


<div class="header column">

    <div class="container">
        
        <a href="https://antweiss.com/"><img class="logo" src="https://avatars2.githubusercontent.com/u/3274734?s=40&amp;v=4" alt="logo"></a>
        
        <div class="content">
            <a href="/"><div class="name"><h1>one man&#39;s singularity</h1></div></a>
            <nav>
                <ul>
                    
                            <li><a href="/blog/">Blog</a></li>
                    
                    
                        
                            
                        
                    
                    
                        
                            <li><a href="/talks/">Talks</a></li>
                        
                    
                        
                    
                        
                            <li><a href="/about/">About</a></li>
                        
                    
                </ul>
            </nav>
        </div>
    </div>
</div>





<div class="main post non-narrow zero-top-spacing column">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    
    Extending Envoy With Wasm and Rust
    

</div>

                </div>
                <div class="meta">
                    <div class="date" title="Fri Apr 17 2020 16:45:18 IDT">Apr 17, 2020</div>
                    
                        
                    
                    
                    <div class="reading-time middot">9 minute read</div>
                    
                    
                      <div class="tags">
                    
                        <ul>
                          
                        </ul>
                    </div>
                    <div class="tags">
                        <ul>
                          
                          
                        </ul>
                    </div>
                </div>
            </div>
            <div class="markdown">
                
    
    <h1 id="extending-envoy-with-wasm-and-rust">Extending Envoy with WASM and Rust</h1>
<hr>
<p><em>If you already know what Istio, Envoy, WASM and Rust have in common and just want to get started building your filter - feel free to skip straight to <a href="#part2">part 2 - Building the Filter</a></em></p>
<hr>
<h1 id="part-1-the-evolution-of-the-mesh">Part 1: The Evolution of the Mesh</h1>
<p>As I’ve mentioned multiple times over the last couple of years - service meshes are the next stage in the evolution of cloud native infrastructure.</p>
<p>The service mesh innovation is advancing on steroids. That’s exactly why <a href="https://layer5.io/">Layer5.io</a> - the service mesh community that I’m proud to be a part of - is focused on making this uncontrollable sprawl of new exciting tech more manageable by creating the service mesh landscape, defining a performance spec and building <a href="https://meshery.io">tools</a> for multi-service mesh management.</p>
<h2 id="the-history-of-istio-extensibility">The History of Istio Extensibility</h2>
<p>Still  - each of the mesh implementations continues developing at its own speed with <strong>Istio</strong> - being backed by Google and IBM  - running ahead of competition on everything related to functionality. But alas - until version 1.5 Istio was also known for performance issues caused by a number of architectural decisions taken early on in project development. One of the main culprits for performance bottlenecks was the component called Mixer. Its main responsibilities in the mesh included enforcing traffic policy and collecting telemetry. Mixer did all this with the help of Adapters - an extension mechanism which conveniently allowed one to integrate Istio with third-party policy and telemetry systems. The downside to this was that Mixer resided in each network request’s data path and caused insufferable latencies when it became overloaded. Check out t<a href="https://kinvolk.io/blog/2019/05/performance-benchmark-analysis-of-istio-and-linkerd/">his benchmark report</a> to see how Istio before version 1.5 used to perform on high traffic volumes.</p>
<p>The Istio team has been working hard to resolve the performance issues. One of the difficult decisions they had to take was tearing the Mixer out and moving telemetry and policy setting functionality into the mesh proxies. In Istio’s case these proxies are <a href="https://www.envoyproxy.io/">Envoy</a> instances. But what about the Mixer adapters? In order to not give up the extensibility in favour of throughput - a new solution had to be designed. It did take long to arrive - and  an exciting one too! Envoy proxy now allows loading WebAssembly modules for use in its network filter chains.</p>
<h2 id="with-wasm-cometh-rust">With WASM cometh Rust</h2>
<p>I won’t waste your time describing what WebAssembly is and how it is the future of secure lightweight computing workloads. There are other blog posts about that. I’ll just say that right now WASM support in Envoy means that one can write filters in either C++, <a href="https://github.com/AssemblyScript/assemblyscript">AssemblyScript</a> or Rust. And it’s the last option that excites me the most - because I’m very fond of Rust and have been looking for a practical project to use it on.</p>
<h2 id="there-is-a-hub">There Is A Hub</h2>
<p>If you want to quickly get started with creating your own WASM-based Envoy filters -
the wonderful folks at Solo.io already provide some tooling to help you get off the ground. Their <a href="https://webassemblyhub.io/">WebAssemblyHub</a> and the <strong>wasme</strong> command-line utility allow one to create filters, package them and deploy to Gloo, Istio or stand-alone Envoy. But as it happens - they still don’t have Rust support built-in.</p>
<p>In general it looks like the proxy-sdk for Rust is somewhat lagging behind its C++ and <a href="https://github.com/AssemblyScript/assemblyscript">AssemblyScript</a> counterparts. At one point when trying to make my Rust-based filter work I even thought that the SDK is not ready yet. But thanks to <a href="https://twitter.com/charypar">Victor Charypar</a> who was incredibly nice to respond to my Github issue I finally realised it’s my version of Envoy that was at fault.</p>
<p>Anyway - in the end I got my filter working and what follows in part 2 of this post is the description of the steps you need to take in order to build your own WASM-based Envoy filter:</p>
<h1 id="part2">Part 2: Building The Filter</h1>
<h2 id="get-the-toolbox-ready">Get the Toolbox Ready</h2>
<p>Your mileage with Rust may vary - so just in case you still don’t have Rust and Cargo (the wonderful Rust package manager) installed - go ahead and get them. On Linux and macOS systems, this is done as follows:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    curl https://sh.rustup.rs -sSf <span style="color:#888">|</span> sh
</code></pre></div><p>If everything goes well, you’ll see this appear:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    Rust is installed now. Great!
</code></pre></div><p>Remember - we’re dealing with bleeding edge functionality here, so the basic Rust installation isn’t sufficient. We’ll also need to install the Rust nightly toolchain and the support for WASM compilation target. Thankfully this is very easy. All you need to is run:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    rustup toolchain install nightly
    rustup target add wasm32-unknown-unknown
</code></pre></div><p>Now we have all the tools ready - let’s initialize our project:</p>
<h2 id="create-the-library">Create the Library</h2>
<p>A WASM filter is compiled from a Rust library project, so first we need to create that project:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    cargo new --lib my-wasm-filter
</code></pre></div><p>This will create a template library project in ‘my-wasm-filter’ directory.  You’ll find a lib.rs file in the src/ directory and a Cargo.toml file that tells Cargo how to build your project.</p>
<h2 id="setting-the-crate-type">Setting the Crate Type</h2>
<p>The resulting library is loaded from Envoy’s C++ code so there’s no need to include any Rust-specific information in it. Therefore we’ll set the crate type to ‘cdylib’ as defined <a href="https://doc.rust-lang.org/edition-guide/rust-2018/platform-and-target-support/cdylib-crates-for-c-interoperability.html">here</a>. This will also produce a smaller binary. To do this - open your Cargo.toml file and under the [lib] section add:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#666">[</span>lib<span style="color:#666">]</span>
    crate-type <span style="color:#666">=</span> <span style="color:#666">[</span><span style="color:#b83838">&#34;cdylib&#34;</span><span style="color:#666">]</span>
</code></pre></div><h2 id="proxy-wasm-sdk">Proxy WASM SDK</h2>
<p>Envoy filters need to be based on the SDKs provided by the <a href="https://github.com/proxy-wasm">proxy-wasm</a> project.  Specifically the <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk">proxy-wasm-rust</a> The first version of the SDK is already published on Crates.io <a href="https://crates.io/crates/proxy-wasm/0.1.0">here</a>. So we’ll need to add it to our Cargo.toml as a dependency:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#666">[</span>dependencies<span style="color:#666">]</span>
    proxy-wasm <span style="color:#666">=</span> <span style="color:#b83838">&#34;0.1.0&#34;</span>
</code></pre></div><p>And now we’re ready to code.</p>
<h2 id="lets-start-coding">Let’s Start Coding</h2>
<p>At the time of writing this - no detailed documentation for writing Envoy WASM filters exists. My code is based on the examples found in the <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk">proxy-sdk</a> project and on this <a href="https://github.com/envoyproxy/envoy-wasm/tree/master/api/wasm/cpp">example</a> for a CPP-based filter in the<a href="https://github.com/envoyproxy/envoy-wasm"> envoy-wasm</a> project.</p>
<p>Basically what we’ll need to do is:</p>
<ul>
<li>Implement a <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk/blob/master/src/traits.rs#L19">base Context trai</a>t for our filter.</li>
<li>Implement an <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk/blob/master/src/traits.rs#L154">HttpContext trait</a> which inherits the base context trait.</li>
<li>Override cont<a href="https://github.com/envoyproxy/envoy-wasm/blob/e8bf3ab26069a387f47a483d619221a0c482cd13/examples/wasm/envoy_filter_http_wasm_example.cc#L14">ext </a>API methods to handle corresponding initialization and http headers/events from host.</li>
<li>Initialize our context by calling <code>proxy_wasm::set_http_context</code></li>
</ul>
<p>Note: our example only takes care of HTTP headers. Should we want to handle other stream and initialization events - we’ll need to implement StreamContext or RootContext accordingly.</p>
<h2 id="what-will-our-filter-do">What Will Our Filter Do?</h2>
<p>I decided to implement a very simple imaginary scenario where each request directed to our service needs to be authorized by sending a token which is then checked for validity by the filter. If the token is validated - the request is passed on to the service. Otherwise - 403 response is returned to the caller.</p>
<p>The validity check for the token is quite dumb - we check if the token is a prime number. In order to do that - let’s add another dependency in our Cargo.toml - the primes crate:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#666">[</span>dependencies<span style="color:#666">]</span>
    proxy-wasm <span style="color:#666">=</span> <span style="color:#b83838">&#34;0.1.0&#34;</span>
    <span style="color:#b04040">primes</span> <span style="color:#666">=</span> <span style="color:#b83838">&#34;0.3.0&#34;</span>
</code></pre></div><h2 id="the-implementation">The Implementation:</h2>
<p>Let’s create our Context:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#a89028">    </span><span style="color:#2838b0">struct</span> <span style="color:#287088">PrimeAuthorizer</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">        </span>context_id: <span style="color:#2838b0;font-style:italic">u32</span><span style="color:#888">,</span><span style="color:#a89028">
</span><span style="color:#a89028">    </span><span style="color:#888">}</span><span style="color:#a89028">
</span></code></pre></div><p>And implement the Context class for it:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#a89028">    </span><span style="color:#2838b0">impl</span><span style="color:#a89028"> </span>Context<span style="color:#a89028"> </span><span style="color:#2838b0">for</span><span style="color:#a89028"> </span>PrimeAuthorizer<span style="color:#a89028"> </span><span style="color:#888">{}</span><span style="color:#a89028">
</span></code></pre></div><p>Note - we don’t need to implement any methods for Context as we’re doing all the work at L7 level - only processing HTTP headers. But we still need to have this in our code because our Context has to implement the base Context trait.</p>
<p>Now to the actual work - let’s implement the HttpContext. We’ll actually only need to implement one method: <code>HttpContext::on_http_request_headers</code> - to validate the headers as they arrive:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-rust" data-lang="rust"><span style="color:#a89028">
</span><span style="color:#a89028">    </span><span style="color:#2838b0">impl</span><span style="color:#a89028"> </span>HttpContext<span style="color:#a89028"> </span><span style="color:#2838b0">for</span><span style="color:#a89028"> </span>PrimeAuthorizer<span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">        </span><span style="color:#2838b0">fn</span> <span style="color:#785840">on_http_request_headers</span><span style="color:#888">(</span><span style="color:#666">&amp;</span><span style="color:#2838b0">mut</span><span style="color:#a89028"> </span><span style="font-style:italic">self</span><span style="color:#888">,</span><span style="color:#a89028"> </span>_: <span style="color:#2838b0;font-style:italic">usize</span><span style="color:#888">)</span><span style="color:#a89028"> </span>-&gt; <span style="color:#287088">Action</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">            </span><span style="color:#2838b0">for</span><span style="color:#a89028"> </span><span style="color:#888">(</span>name<span style="color:#888">,</span><span style="color:#a89028"> </span>value<span style="color:#888">)</span><span style="color:#a89028"> </span><span style="color:#2838b0">in</span><span style="color:#a89028"> </span><span style="color:#666">&amp;</span><span style="font-style:italic">self</span><span style="color:#888">.</span>get_http_request_headers<span style="color:#888">()</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">                </span>trace<span style="color:#666">!</span><span style="color:#888">(</span><span style="color:#b83838">&#34;In WASM : #{} -&gt; {}: {}&#34;</span><span style="color:#888">,</span><span style="color:#a89028"> </span><span style="font-style:italic">self</span><span style="color:#888">.</span>context_id<span style="color:#888">,</span><span style="color:#a89028"> </span>name<span style="color:#888">,</span><span style="color:#a89028"> </span>value<span style="color:#888">);</span><span style="color:#a89028">
</span><span style="color:#a89028">            </span><span style="color:#888">}</span><span style="color:#a89028">
</span><span style="color:#a89028">
</span><span style="color:#a89028">            </span><span style="color:#2838b0">match</span><span style="color:#a89028"> </span><span style="font-style:italic">self</span><span style="color:#888">.</span>get_http_request_header<span style="color:#888">(</span><span style="color:#b83838">&#34;token&#34;</span><span style="color:#888">)</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">                </span><span style="color:#388038">Some</span><span style="color:#888">(</span>token<span style="color:#888">)</span><span style="color:#a89028"> </span><span style="color:#2838b0">if</span><span style="color:#a89028"> </span>is_prime<span style="color:#888">(</span>token<span style="color:#888">.</span>parse<span style="color:#888">().</span>unwrap<span style="color:#888">())</span><span style="color:#a89028"> </span><span style="color:#666">=&gt;</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">                    </span><span style="font-style:italic">self</span><span style="color:#888">.</span>resume_http_request<span style="color:#888">();</span><span style="color:#a89028">
</span><span style="color:#a89028">                    </span>Action::Continue<span style="color:#a89028">
</span><span style="color:#a89028">                </span><span style="color:#888">}</span><span style="color:#a89028">
</span><span style="color:#a89028">                </span>_<span style="color:#a89028"> </span><span style="color:#666">=&gt;</span><span style="color:#a89028"> </span><span style="color:#888">{</span><span style="color:#a89028">
</span><span style="color:#a89028">                    </span><span style="font-style:italic">self</span><span style="color:#888">.</span>send_http_response<span style="color:#888">(</span><span style="color:#a89028">
</span><span style="color:#a89028">                        </span><span style="color:#444">403</span><span style="color:#888">,</span><span style="color:#a89028">
</span><span style="color:#a89028">                        </span>vec<span style="color:#666">!</span><span style="color:#888">[(</span><span style="color:#b83838">&#34;Powered-By&#34;</span><span style="color:#888">,</span><span style="color:#a89028"> </span><span style="color:#b83838">&#34;proxy-wasm&#34;</span><span style="color:#888">)],</span><span style="color:#a89028">
</span><span style="color:#a89028">                        </span><span style="color:#388038">Some</span><span style="color:#888">(</span><span style="color:#b83838">b&#34;Access forbidden.</span><span style="color:#709030">\n</span><span style="color:#b83838">&#34;</span><span style="color:#888">),</span><span style="color:#a89028">
</span><span style="color:#a89028">                    </span><span style="color:#888">);</span><span style="color:#a89028">
</span><span style="color:#a89028">                    </span>Action::Pause<span style="color:#a89028">
</span><span style="color:#a89028">                </span><span style="color:#888">}</span><span style="color:#a89028">
</span><span style="color:#a89028">            </span><span style="color:#888">}</span><span style="color:#a89028">
</span><span style="color:#a89028">        </span><span style="color:#888">}</span><span style="color:#a89028">
</span><span style="color:#a89028">    </span><span style="color:#888">}</span><span style="color:#a89028">
</span></code></pre></div><p>As you can see  -  the method calls self.get_http_request_header to find the header named ‘token’ and then checks it for primacy. In case the token is a prime number - self.resume_http_request() passes the request further to the target cluster. Otherwise a 403 response is returned saying “Acess forbidden”. The method returns an <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk/blob/master/src/types.rs#L34">Action</a>  enum which tells Envoy whether to continue the request processing or to pause and wait for the next request.</p>
<h2 id="testing-the-filter">Testing The Filter</h2>
<p>While building the filter was quite easy - verifying that it works proved to be a bit painful. The official Envoy binaries still don’t have WASM support built-in. But I assumed that if I build my own Envoy binary with WASM enabled - the filter should get loaded fine. The binary I built was based on <a href="https://github.com/envoyproxy/envoy-wasm">this github repo</a>, but alas - Envoy was crashing with “Failed to load WASM module due to a missing import: env.proxy_get_configuration”</p>
<p>Next step - I decided to use the Envoy image used by<a href="https://docs.solo.io/web-assembly-hub/latest/tutorial_code/getting_started/"> wasme CLI utility</a> to test filters it helps build. This is the one: <!-- raw HTML omitted --><a href="https://quay.io/repository/solo-io/gloo-envoy-wasm-wrapper">https://quay.io/repository/solo-io/gloo-envoy-wasm-wrapper</a> <!-- raw HTML omitted --></p>
<p>But this time Envoy was crashing with “&ldquo;WASM missing malloc/free&rdquo; . While trying to work around this I opened a <a href="https://github.com/proxy-wasm/proxy-wasm-rust-sdk/issues/3">github issue </a>on the proxy-wasm-rust project. And thanks to <a href="https://twitter.com/charypar">Victor Charypar</a> I finally realized I should’ve been using the Envoy binary from the official Istio proxy image: <a href="https://hub.docker.com/r/istio/proxyv2">https://hub.docker.com/r/istio/proxyv2</a> . Specifically the 1.5.0 tag. Once I built my image based on that - everything clicked! Hooray, my fitler does what I expect it to do!</p>
<p>My final project complete with the testing setup in a docker-compose file can be found here:</p>
<p><a href="https://github.com/otomato-gh/proxy-wasm-rust">https://github.com/otomato-gh/proxy-wasm-rust</a></p>
<p>All you need to do is:</p>
<ol>
<li>
<p>Clone the repo</p>
</li>
<li>
<p>cargo +nightly build &ndash;target=wasm32-unknown-unknown &ndash;release</p>
<p>This will create the file ‘myenvoyfilter.wasm’ in &lt;your-clone-directory&gt;/target/wasm32-unknown-unknown. The name of the WASM file is defined by this configuration in Cargo.toml:</p>
</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#666">[</span>lib<span style="color:#666">]</span>
    <span style="color:#b04040">name</span> <span style="color:#666">=</span> <span style="color:#b83838">&#34;myenvoyfilter&#34;</span>
</code></pre></div><ol start="3">
<li>
<p>docker-compose up &ndash;build</p>
<p>This will build a new envoy image based on istio/proxyv2 and pull an image for hasicorp/http-echo that is used as the target service</p>
<p>You should see something like:</p>
</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    proxy_1        <span style="color:#888">|</span> <span style="color:#666">[</span>2020-04-17 13:15:36.931<span style="color:#666">][</span>14<span style="color:#666">][</span>debug<span style="color:#666">][</span>wasm<span style="color:#666">]</span> <span style="color:#666">[</span>external/envoy/source/extensions/common/wasm/wasm.cc:285<span style="color:#666">]</span> Thread-Local Wasm created <span style="color:#444">4</span> now active


    proxy_1        <span style="color:#888">|</span> <span style="color:#666">[</span>2020-04-17 13:15:36.935<span style="color:#666">][</span>14<span style="color:#666">][</span>debug<span style="color:#666">][</span>upstream<span style="color:#666">]</span> <span style="color:#666">[</span>external/envoy/source/common/upstream/cluster_manager_impl.cc:1084<span style="color:#666">]</span> membership update <span style="color:#2838b0">for</span> TLS cluster web_service added <span style="color:#444">1</span> removed <span style="color:#444">0</span>
</code></pre></div><p>Note that Envoy is set up to listen on port 18000 of your host machine.
And that our newly-built filter is loaded from our build target:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#a89028">     </span><span style="color:#2838b0">proxy</span><span style="color:#888">:</span><span style="color:#a89028">
</span><span style="color:#a89028">      </span>..<span style="color:#a89028">
</span><span style="color:#a89028">       </span><span style="color:#2838b0">volumes</span><span style="color:#888">:</span><span style="color:#a89028">
</span><span style="color:#a89028">         </span>- ./envoy/envoy.yaml:/etc/envoy.yaml<span style="color:#a89028">
</span><span style="color:#a89028">         </span>- ./target/wasm32-unknown-unknown/release/myenvoyfilter.wasm:/etc/myenvoyfilter.wasm<span style="color:#a89028">
</span><span style="color:#a89028">        </span>..<span style="color:#a89028">
</span><span style="color:#a89028">       </span><span style="color:#2838b0">ports</span><span style="color:#888">:</span><span style="color:#a89028">
</span><span style="color:#a89028">         </span>- <span style="color:#b83838">&#34;18000:80&#34;</span><span style="color:#a89028">
</span></code></pre></div><p>Now go to another prompt and verify everything works as expected by sending curl requests:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    curl  -H <span style="color:#b83838">&#34;token&#34;</span>:<span style="color:#b83838">&#34;323232&#34;</span> 0.0.0.0:18000
    Access forbidden.

    curl  -H <span style="color:#b83838">&#34;token&#34;</span>:<span style="color:#b83838">&#34;32323&#34;</span> 0.0.0.0:18000
    <span style="color:#b83838">&#34;Welcome to WASM land&#34;</span>
</code></pre></div><p>Feel free to try this with other prime and non-prime numbers or strings. Let me know if you succeed in breaking it. :)</p>
<h2 id="summary">Summary:</h2>
<ul>
<li>WASM filters allow extending Envoy functionality</li>
<li>We can build WASM filters for Envoy with Rust</li>
<li>Currently one needs the Envoy binary from Istio1.5+ to successfully execute such a filter.</li>
</ul>
<p>Next time I get to write about this we’ll see how to deploy our Rusty filters to an Istio cluster and hopefully - we’ll be doing it with <a href="https://meshery.io">Meshery</a> once the support for this is ready.</p>
<p>Looking forward to your questions and comments.</p>


            </div>
            
            <br>
            <div class="share">
                  
                  <a href="" class="ssk ssk-facebook"></a>
                  
                  
                  <a href="" class="ssk ssk-twitter"></a>
                  
                  
                  <a href="" class="ssk ssk-google-plus"></a>
                  
                  
                  <a href="" class="ssk ssk-linkedin"></a>
                  
            </div>
            
            
            <br>
            <div class="navigation">
                
                <div>
                    <img class="icon" src="/img/back.svg" alt="back" />
                    <a href="https://antweiss.com/blog/announcing-devops-shorts/">Announcing Devops Shorts</a>
                </div>
                
                <div style="width: 100%;"></div>
                
                <div>
                    <a href="https://antweiss.com/blog/devops-shorts-001-tobias-kunze/">Devops Shorts 001 - Tobias Kunze</a>
                    <img class="icon" src="/img/next.svg" alt="next" />
                </div>
                
            </div>
            
            
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "antweiss" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            

            
            

            

            
        </div>
    </div>
</div>



<div class="footer column">
    <div class="container">

        

        

        <div class="copyright">

        

        </div>
        <div class="icons">

        

        

        

        

        

        

        
            <a href="https://github.com/antweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/github.svg" alt="github" />
            </a>
        

        
            <a href="https://twitter.com/antweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/twitter.svg" alt="twitter" />
            </a>
        

        
            <a href="https://www.linkedin.com/in/antonweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/linkedin.svg" alt="linkedin" />
            </a>
        

        

        

        
            <a href="mailto:anton@otomato.io">
                <img class="icon" src="https://antweiss.com/img/email.svg" alt="email" />
            </a>
        

        
            <a href="https://antweiss.com/index.xml">
                <img class="icon" src="https://antweiss.com/img/rss.svg" alt="rss" />
            </a>
        

        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Raleway:400,600,700', 'Merriweather:300,300i,700,700i', 'Ubuntu+Mono:400,700']
    }
  });
</script>



  <script src="https://antweiss.com/js/highlight.min.js" defer></script>
  



  <script src="https://antweiss.com/js/progressively.min.js" defer></script>



  <script src="https://antweiss.com/js/social-share-kit.min.js" defer></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-161003981-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script>
  window.onload = function() {
    
      hljs.initHighlighting();
    
    
      progressively.init({delay: 30, throttle: 50});
    
    
      SocialShareKit.init({
        twitter: {
            text: '',
            via: 'antweiss'
        }
      });
    
  };
</script>




</body>
</html>

