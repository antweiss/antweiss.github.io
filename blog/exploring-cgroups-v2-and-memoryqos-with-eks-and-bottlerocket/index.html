<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="One Man&#39;s Singularity">


    <meta property="twitter:site" content="@antweiss">

<meta property="og:site_name" content="one man&#39;s singularity" />
<meta property="og:locale" content="en-us" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://antweiss.com/blog/exploring-cgroups-v2-and-memoryqos-with-eks-and-bottlerocket/" />
<meta property="og:title" content="Exploring cgroups v2 and MemoryQoS With EKS and Bottlerocket" />
<meta property="twitter:title" content="Exploring cgroups v2 and MemoryQoS With EKS and Bottlerocket">

    <meta property="og:image" content="https://antweiss.com/img/horns-bw.png">
    <meta property="twitter:card" content="summary">
    <meta property="twitter:image" content="https://antweiss.com/img/horns-bw.png">

<meta property="og:description" content="">
<meta property="twitter:description" content="">

<title>


     one man&#39;s singularity - Exploring cgroups v2 and MemoryQoS With EKS and Bottlerocket 

</title>
<link rel="canonical" href="https://antweiss.com/blog/exploring-cgroups-v2-and-memoryqos-with-eks-and-bottlerocket/">


<style media="screen">
  @font-face {
  font-family: 'Nexa Bold';
  src: url('https://antweiss.com/fonts/Nexa Bold.otf');
}

html, body, div, span, applet, object, iframe,
h1, h2, h3, h4, h5, h6, p, blockquote, pre,
a, abbr, acronym, address, big, cite, code,
del, dfn, em, img, ins, kbd, q, s, samp,
small, strike, strong, sub, tt, var,
b, u, i, center,
dl, dt, dd, ol, ul, li,
fieldset, form, label, legend,
table, caption, tbody, tfoot, thead, tr, th, td,
article, aside, canvas, details, embed,
figure, figcaption, footer, header, hgroup,
menu, nav, output, ruby, section, summary,
time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
  font-size: 100%;
  font: inherit;
  vertical-align: baseline;
}
img[src$='#floatleft']
{
	float:left;
  margin-right: 1em;
}

img[src$='#floatright']
{
	float:right;
       //etc. etc.
}
/* HTML5 display-role reset for older browsers */
article, aside, details, figcaption, figure,
footer, header, hgroup, menu, nav, section, div.column {
  display: block;
}
body {
  line-height: 1;
}
ol, ul {
  list-style: none;
}
blockquote, q {
  quotes: none;
}
blockquote:before, blockquote:after,
q:before, q:after {
  content: '';
  content: none;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}

*,
*:before,
*:after {
  box-sizing: border-box;
}
a,
a:visited,
a:focus,
a:active {
  text-decoration: underline;
}
html {
  height: 100%;
  font-size: 16px;
}
body {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
  width: 100%;
  min-height: 100%;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  color: #111111;
  line-height: 1.6;
  text-rendering: optimizeLegibility !important;
}
.icon {
  text-rendering: geometricPrecision !important;
}
section {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
div.column {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  width: 100%;
}
.container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  width: 100%;
}
div.header .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.header .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.header .container .logo {
  
  max-width: 100px;
  
  margin-left: 1em;
  margin-right: 1em;
}
div.header .a {
  text-decoration: none;
}
div.header .name {
  padding-top: 20px;
  font-size: 28px;
  font-family: 'Nexa Bold', 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  
  text-transform: uppercase;
  
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
}
div.header nav {
  margin-bottom: 16px;
}
div.header nav ul {
  list-style: none;
  text-align: center;
  display: -webkit-inline-flex;
  display: -moz-inline-flex;
  display: -ms-inline-flexbox;
  display: -ms-inline-flex;
  display: inline-flex;
}
div.header nav ul li {
  margin-left: 6px;
  margin-right: 6px;
}
div.header nav ul li:first-child {
  margin-left: 0;
}
div.header nav ul li:last-child {
  margin-right: 0;
}
div.header nav ul a {
  color: #555555;
  font-weight: 400;
  font-size: 14px;
  text-transform: uppercase;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}

div.footer .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
  flex-direction: column-reverse;
  width: 100%;
  text-align: center;
}
div.footer .container a {
  font-size: 14px;
  margin-left: 6px;
  margin-right: 6px;
  opacity: 0.6;
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.footer .container a:first-child {
  margin-left: 0;
}
div.footer .container a:last-child {
  margin-right: 0;
}
div.footer .container a:hover {
  opacity: 0.8;
}
div.footer .container a .icon {
  width: 16px;
  height: 16px;
}
div.footer .container .copyright {
  flex-grow: 0.5;
  text-align: start;
}
div.footer .container .icons {
  flex-grow: 0.5;
  text-align: end;
}
div.main .container {
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  -webkit-justify-content: flex-start;
  -moz-justify-content: flex-start;
  -ms-justify-content: flex-start;
  justify-content: flex-start;
}
div.main .content {
  color: #111111;
  font-size: 16px;
}
div.main .content .title-container {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-justify-content: space-between;
  -moz-justify-content: space-between;
  -ms-justify-content: space-between;
  justify-content: space-between;
}
div.main .content .posts {
  
  
}
div.main .content .page-heading {
  font-size: 20px;
  font-weight: 700;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  text-transform: uppercase;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
  color: #333333;
  margin-bottom: 16px;
}
div.main .content .front-matter .page-heading {
  margin-bottom: 0;
}
div.main .content .front-matter .meta {
  font-size: 14px;
  color: #666666;
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  margin-bottom: 32px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
  display: none;
}
div.main .content .front-matter .middot:before {
  font-size: 6px;
  margin: 0 6px;
  vertical-align: middle;
  content: "â€¢";
}
div.main .content .front-matter .tags ul {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .content .front-matter .tags ul li {
  -webkit-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: opacity 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
div.main .content .front-matter .tags ul li:hover {
  opacity: 0.7;
}
div.main .content .front-matter .tags ul li a {
  color: #666666;
}

div.main .container.f04 {
  -webkit-justify-content: center;
  -moz-justify-content: center;
  -ms-justify-content: center;
  justify-content: center;
}
div.main .container.f04 .content {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
}
div.main .container.f04 .content .num {
  margin: 30px 0px 30px 0;
  font-weight: 400;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  font-size: 50px;
}
div.main .container.f04 .content .detail {
  margin-bottom: 40px;
}
div.main .container .content .groupby {
  margin-top: 1em;
  padding-left: 0.5em;
}
div.main .container .content .post-item {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  display: list-item;
  list-style: disc inside;
}
div.main .container .content .post-item .meta {
  font-size: 14px;
  color: #666666;
  display: none;
  min-width: 100px;
}
div.main .container .content .see-more {
  font-style: italic;
  float: right;
  font-size: 0.9em;
  margin-top: 2em;
  color: #313537;
}
div.main .container .content .see-more:hover {
  color: #666;
}
section {
  padding: 0 16px;
}
div.column {
  padding: 0 16px;
}
div.header {
  padding-top: 10px;
}
div.header-home {
  padding-top: 36px;
  max-width: 80%;
}
div.main {
  padding-top: 32px;
}
div.main .container .content .post-item .meta {
    display: block;
}
div.main .container .content .post-item {
    display: flex;
    list-style: none;
}
a {
/*  color: #428bca;*/
  -webkit-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -moz-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -ms-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
  -o-transition: color 0.1s cubic-bezier(0.47, 0, 0.75, 0.72);
}
a:hover {
  color: yellow;
}
img {
  max-width: 50%;
}
div.main .content {
    width: 100%;
}
div.main .content .markdown {
  font-size: 1.1em;
  line-height: 1.75em;
  color: #313537;
  font-family: serif;
  font-weight: 300;
}
div.main .content .markdown h1,
div.main .content .markdown h2,
div.main .content .markdown h3,
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 22px;
  font-family: 'Helvetica Neue', 'Arial', sans-serif;
  letter-spacing: -0.005rem;
  font-weight: 700;
  -moz-osx-font-smoothing: grayscale;
  -webkit-font-smoothing: antialiased;
  font-smoothing: antialiased;
/*  color: #333333; */
  text-transform: none;
  margin-top: 1.75rem;
}
div.main .content .markdown h1 {
  font-size: 1.75rem;
  margin-bottom: 2rem;
}
div.main .content .markdown h2 {
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
}
div.main .content .markdown h3 {
  font-size: 1em;
  margin-bottom: 1rem;
}
div.main .content .markdown h4,
div.main .content .markdown h5,
div.main .content .markdown h6 {
  font-size: 1rem;
  margin-bottom: 1rem;
  letter-spacing: none;
}
div.main .content .markdown code,
div.main .content .markdown pre {
  font-family: 'Menlo', monospace;
  font-size: 0.98rem;
/*  background-color: #f7f7f7; */
}
div.main .content .markdown code {
  /* enclosed by single backtick (`) */
  padding: .15em .5em;
  border-radius: 2px;
}
div.main .content .markdown pre {
  /* Hugo specific: consider using the 'highlight' shortcode */
  display: block;
  margin-top: 1rem;
  margin-bottom: 1rem;
  padding: 0;
  line-height: 1.5em;
  white-space: pre;
  word-break: break-all;
  word-wrap: break-word;
}
div.main .content .markdown pre code {
  /* enclosed by 4 backticks (````) */
  padding: 0;
  font-size: 0.9rem;
}
div.main .content .markdown a code {
  color: #428bca !important;
}
div.main .content .markdown a code:hover {
  text-decoration: underline;
}
div.main .content .markdown p {
  
  text-align: justify;
  
  margin-top: 0;
  margin-bottom: 1em;
}
div.main .content .markdown ul,
div.main .content .markdown ol,
div.main .content .markdown dl {
  text-align: justify;
  margin-top: 1rem;
  margin-bottom: 2rem;
}
div.main .content .markdown dt {
  font-weight: bold;
}
div.main .content .markdown dd {
  margin-bottom: .5rem;
}
div.main .content .markdown ul {
  list-style-type: disc;
  list-style-position: outside;
  margin-bottom: 1.25rem;
}
div.main .content .markdown ol {
  list-style-type: decimal;
  margin-bottom: 1.25rem;
}
div.main .content .markdown li {
  margin-left: 2em;
}
div.main .content .markdown em {
  font-style: italic;
}
div.main .content .markdown strong {
  font-weight: 700;
}
div.main .content .markdown hr {
  position: relative;
  margin: 1.75rem 0;
  border: 0;
  border-top: 1px solid #808080;
  border-top: 1px solid #999999;
}
div.main .content .markdown abbr {
  font-size: 0.85rem;
  font-weight: bold;
  color: #666666;
  text-transform: uppercase;
}
div.main .content .markdown abbr[title] {
  cursor: help;
  border-bottom: 1px dotted #808080;
}
div.main .content .markdown blockquote {
  padding: .5rem 1rem;
  margin: .8rem 0;
  color: #7a7a7a;
  border-left: .25rem solid #e5e5e5;
}
div.main .content .markdown blockquote p:last-child {
  margin-bottom: 0;
}
div.main .content .markdown figure {
  width: 100%;
  background: #fff;
  margin-bottom: 1em;
}
div.main .content .markdown figure img {
  width: 100%;
  height: auto;
  max-width: 50%;
  display: block;
  position: static;
  margin: auto;
}
div.main .content .markdown table {
  margin-bottom: 1rem;
  width: 100%;
  border: 1px solid #e5e5e5;
  border-collapse: collapse;
}
div.main .content .markdown td,
div.main .content .markdown th {
  padding: .25rem .5rem;
  border: 1px solid #e5e5e5;
}
div.main .content .markdown tbody tr:nth-child(odd) td,
div.main .content .markdown tbody tr:nth-child(odd) th {
  /* background-color: #f7f7f7; */
}
div.main .content .markdown .footnotes ol {
  list-style-type: decimal;
  margin-left: 16px;
}
div.main .content .markdown .footnotes li {
  list-style-type: unset;
}
div.main .content .markdown .footnote-ref {
  font-size: 0.7em;
}
div.main .content .navigation {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: column;
  -moz-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  padding: 2em;
}
div.main .content .navigation div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  margin-top: 1em;
}
div.main .content .navigation .icon {
  width: 16px;
  height: 16px;
}
div.main .content .navigation a {
  width: 250px;
  margin: 0 1em;
  text-align: center;
  font-style: italic;
  color: #313537;
}
div.main .content .share, div.main .content .share div {
  display: -webkit-flex;
  display: -moz-flex;
  display: -ms-flexbox;
  display: -ms-flex;
  display: flex;
  -webkit-flex-direction: row;
  -moz-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  -webkit-align-items: center;
  -moz-align-items: center;
  -ms-align-items: center;
  align-items: center;
  justify-content: center;
}
div.main .content .share {
  /* background-color: rgba(152, 152, 152, 0.07); */
  padding: 1em 0;
}
div.main .content .share a {
  margin: 0 6px;
}
kbd {
  padding: 0.1em 0.6em;
  border: 1px solid #ccc;
  font-size: 11px;
  font-family: Arial,Helvetica,sans-serif;
  /* background-color: #f7f7f7; */
  color: #333;
  -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;
  -moz-border-radius: 3px;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  display: inline-block;
  margin: 0 0.1em;
  text-shadow: 0 1px 0 #fff;
  line-height: 1.4;
  white-space: nowrap;
}

/* Fonts */


.wf-raleway-n4-active body, 
.wf-raleway-n4-active div.header nav ul a,
.wf-raleway-n7-active div.main .content .page-heading,
.wf-raleway-n2-active div.main .container.f04 .content .num,
.wf-raleway-n7-active div.main .content .markdown h1,
.wf-raleway-n7-active div.main .content .markdown h2,
.wf-raleway-n7-active div.main .content .markdown h3,
.wf-raleway-n7-active div.main .content .markdown h4,
.wf-raleway-n7-active div.main .content .markdown h5,
.wf-raleway-n7-active div.main .content .markdown h6 {
      font-family: 'Raleway';
}

.wf-merriweather-n3-active div.main .content .markdown {
      font-family: 'Merriweather';
}

.wf-ubuntu-mono-n4-active div.main .content .markdown code,
.wf-ubuntu-mono-n4-active div.main .content .markdown pre {
      font-family: 'Ubuntu Mono';
}


</style>
<style media="(min-width: 600px)">
  body {
-webkit-justify-content: center;
-moz-justify-content: center;
-ms-justify-content: center;
justify-content: center;
}
.non-narrow.zero-top-spacing {
padding-top: 0 !important;
}
section {
padding: 0 16px;
margin-left: 100px;
margin-right: 100px;

max-width: 750px;

}
div.column {
padding: 0 16px;

max-width: 750px;

}
div.header {
background-color: transparent;
}
div.header .container {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.header .container .logo {
margin: 0;
margin-right: 1em;
}
div.header-home .container .logo {
max-width: 216px;
margin-left: 24px;
margin-right: 1em;
}
div.header-home .name-home {
padding-top: 30px;
font-size: 40px;
}
div.header-home nav ul a {
font-size: 18px;
}
div.header .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.header .name {
color: #333333;
}
div.header nav {
font-size: 14px;
margin-bottom: 0;
}
div.header nav ul {
text-align: left;
}
div.header nav ul a {
color: #666666;
}
div.header nav ul a:hover {
color: #333333;
}
div.footer {
background-color: transparent;
}
div.footer .container {
flex-direction: row;
}
div.footer .container a {
margin-left: 3px;
margin-right: 3px;
color: #666666;
}
div.footer .container a:hover {
color: #333333;
}
div.footer .container a .icon {
font-size: 18px;
}
div.footer .container a .icon.larger {
font-size: 20px;
}
div.main .content .front-matter .date,
div.main .content .front-matter .author,
div.main .content .front-matter .tags,
div.main .content .front-matter .word-count,
div.main .content .front-matter .middot:before {
display: initial;
}
div.main .container.f04 {
-webkit-justify-content: flex-start;
-moz-justify-content: flex-start;
-ms-justify-content: flex-start;
justify-content: flex-start;
}
div.main .container.f04 .content {
-webkit-align-items: flex-start;
-moz-align-items: flex-start;
-ms-align-items: flex-start;
align-items: flex-start;
}
div.main .container.f04 .content .num {
margin: 0 0 10px 0;
font-size: 32px;
}
div.main .container.f04 .content .detail {
margin-bottom: 30px;
}
.container {
padding: 0 30px;
}
div.header {
padding-top: 60px;
padding-bottom: 60px;
}
div.footer {
padding-top: 60px;
padding-bottom: 60px;
}
div.main {
padding-top: 0;
}
div.main .content {
  
  font-size: 16px;
  
}
div.main .container .content .post-item {
display: flex;
list-style: none;
padding-left: 1.5em;
}
div.main .container .content .post-item .meta {
display: block;
}
div.main .content .markdown blockquote {
padding-right: 5rem;
padding-left: 1.25rem;
}
div.main .content .navigation {
-webkit-flex-direction: row;
-moz-flex-direction: row;
-ms-flex-direction: row;
flex-direction: row;
}
div.main .content .navigation div {
margin-top: 0em;
}

</style>
<style media="(min-width: 769px)">
  div.main .content .markdown figure {
width: 110%;
margin-left: -4%;
}
div.main .content .markdown img {
max-width: 110%;
width: 110%;
margin-left: -4%;
}
div.main .content .markdown pre {
width: 110%;
margin-left: -4%;
}

</style>

<noscript>
  <link href="https://fonts.googleapis.com/css?family=Raleway:400,600,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Merriweather:300,300i,700,700i" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700" rel="stylesheet">
</noscript>


  <style type="text/css" media="screen">
    .hljs{display:block;background:white;padding:0.5em;color:#333333;overflow-x:auto}.hljs-comment,.hljs-meta{color:#969896}.hljs-string,.hljs-variable,.hljs-template-variable,.hljs-strong,.hljs-emphasis,.hljs-quote{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#a71d5d}.hljs-literal,.hljs-symbol,.hljs-bullet,.hljs-attribute{color:#0086b3}.hljs-section,.hljs-name{color:#63a35c}.hljs-tag{color:#333333}.hljs-title,.hljs-attr,.hljs-selector-id,.hljs-selector-class,.hljs-selector-attr,.hljs-selector-pseudo{color:#795da3}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}
  </style>



  <style type="text/css" media="screen">
    .progressive{overflow:hidden;position:relative;background:#efefef}.progressive__img{width:100%;height:100%;transform:translateZ(0)}.progressive--not-loaded{filter:blur(30px)}.progressive--is-loaded{filter:blur(20px);animation:a .5s both}@keyframes a{0%{filter:blur(20px)}to{filter:blur(0)}}

  </style>



  <style type="text/css" media="screen">
    /*!
 * Social Share Kit v1.0.7 (http://socialsharekit.com)
 * Copyright 2015 Social Share Kit / Kaspars Sprogis.
 * Licensed under Creative Commons Attribution-NonCommercial 3.0 license:
 * https://github.com/darklow/social-share-kit/blob/master/LICENSE
 * ---
 */@font-face{font-family:'social-share-kit';src:url('https://antweiss.com/fonts/social-share-kit.eot');src:url('https://antweiss.com/fonts/social-share-kit.eot?#iefix') format('embedded-opentype'),url('https://antweiss.com/fonts/social-share-kit.woff') format('woff'),url('https://antweiss.com/fonts/social-share-kit.ttf') format('truetype'),url('https://antweiss.com/fonts/social-share-kit.svg#social-share-kit') format('svg');font-weight:normal;font-style:normal}.ssk:before{display:inline-block;font-family:"social-share-kit" !important;font-style:normal !important;font-weight:normal !important;font-variant:normal !important;text-transform:none !important;speak:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.ssk-facebook:before{content:"a";text-indent:4px;margin-right:-4px}.ssk-twitter:before{content:"b"}.ssk-google-plus:before{content:"v"}.ssk-google-plus-old:before{content:"c"}.ssk-email:before{content:"d";top:-1px;position:relative}.ssk-pinterest:before{content:"e"}.ssk-tumblr:before{content:"f"}.ssk-linkedin:before{content:"g"}.ssk-github:before{content:"h"}.ssk-vk:before{content:"i"}.ssk-instagram:before{content:"j"}.ssk-amazon:before{content:"k"}.ssk-skype:before{content:"s"}.ssk-youtube:before{content:"x"}.ssk-vimeo:before{content:"u"}.ssk-ebay:before{content:"p"}.ssk-apple:before{content:"l"}.ssk-behance:before{content:"q"}.ssk-dribble:before{content:"n"}.ssk-android:before{content:"o"}.ssk-whatsapp:before{content:"m"}.ssk-reddit:before{content:"r"}.ssk-reddit2:before{content:"t"}.ssk-link:before{content:"w"}.ssk{background-color:#757575;color:white;display:inline-block;font-size:22px;line-height:1px;margin-right:2px;margin-bottom:2px;padding:7px;text-align:center;text-decoration:none;transition:background-color .1s;-webkit-transition:background-color .1s;-moz-transition:background-color .1s;-ms-transition:background-color .1s;-o-transition:background-color .1s}.ssk:before,.ssk .glyphicon,.ssk .fa{position:relative;font-size:22px;top:0;vertical-align:middle}.ssk.ssk-xs,.ssk-xs>.ssk{padding:4px}.ssk.ssk-xs:before,.ssk-xs>.ssk:before,.ssk.ssk-xs .glyphicon,.ssk-xs>.ssk .glyphicon,.ssk.ssk-xs .fa,.ssk-xs>.ssk .fa{font-size:15px}.ssk.ssk-sm,.ssk-sm>.ssk{padding:5px}.ssk.ssk-sm:before,.ssk-sm>.ssk:before,.ssk.ssk-sm .glyphicon,.ssk-sm>.ssk .glyphicon,.ssk.ssk-sm .fa,.ssk-sm>.ssk .fa{font-size:20px}.ssk.ssk-lg,.ssk-lg>.ssk{padding:9px}.ssk.ssk-lg:before,.ssk-lg>.ssk:before,.ssk.ssk-lg .glyphicon,.ssk-lg>.ssk .glyphicon,.ssk.ssk-lg .fa,.ssk-lg>.ssk .fa{font-size:28px}.ssk:last-child{margin-right:0}.ssk:hover{background-color:#424242}.ssk:hover,.ssk:focus{color:#fff;text-decoration:none}.ssk.ssk-round,.ssk-round .ssk{border-radius:50%}.ssk.ssk-round:before,.ssk-round .ssk:before{text-indent:0;margin-right:0}.ssk.ssk-rounded,.ssk-rounded .ssk{border-radius:15%}.ssk.ssk-icon{color:#757575;padding:2px;font-size:24px}.ssk.ssk-icon,.ssk.ssk-icon:hover{background-color:transparent}.ssk.ssk-icon:hover{color:#424242}.ssk.ssk-icon.ssk-xs,.ssk-xs>.ssk.ssk-icon{font-size:16px}.ssk.ssk-icon.ssk-sm,.ssk-sm>.ssk.ssk-icon{font-size:20px}.ssk.ssk-icon.ssk-lg,.ssk-lg>.ssk.ssk-icon{font-size:28px}.ssk.ssk-text{overflow:hidden;font-size:17px;line-height:normal;padding-right:10px}.ssk.ssk-text:before,.ssk.ssk-text .glyphicon,.ssk.ssk-text .fa{margin:-7px 10px -7px -7px;padding:7px;background-color:rgba(0,0,0,0.15);vertical-align:bottom;text-indent:0}.ssk-block .ssk.ssk-text{display:block;margin-right:0;text-align:left}.ssk.ssk-text.ssk-xs,.ssk-xs>.ssk.ssk-text{font-size:12px;padding-right:6px}.ssk.ssk-text.ssk-xs:before,.ssk-xs>.ssk.ssk-text:before,.ssk.ssk-text.ssk-xs .glyphicon,.ssk-xs>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-xs .fa,.ssk-xs>.ssk.ssk-text .fa{margin:-4px 6px -4px -4px;padding:4px}.ssk.ssk-text.ssk-sm,.ssk-sm>.ssk.ssk-text{font-size:16px;padding-right:7px}.ssk.ssk-text.ssk-sm:before,.ssk-sm>.ssk.ssk-text:before,.ssk.ssk-text.ssk-sm .glyphicon,.ssk-sm>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-sm .fa,.ssk-sm>.ssk.ssk-text .fa{margin:-5px 7px -5px -5px;padding:5px}.ssk.ssk-text.ssk-lg,.ssk-lg>.ssk.ssk-text{font-size:22px;padding-right:13px}.ssk.ssk-text.ssk-lg:before,.ssk-lg>.ssk.ssk-text:before,.ssk.ssk-text.ssk-lg .glyphicon,.ssk-lg>.ssk.ssk-text .glyphicon,.ssk.ssk-text.ssk-lg .fa,.ssk-lg>.ssk.ssk-text .fa{margin:-9px 13px -9px -9px;padding:9px}.ssk-group,.ssk-sticky{font-size:0}.ssk-sticky{top:0;position:fixed;z-index:2000}.ssk-sticky .ssk{transition:padding .1s ease-out;-webkit-transition:padding .1s ease-out;-moz-transition:padding .1s ease-out;-ms-transition:padding .1s ease-out;-o-transition:padding .1s ease-out;margin:0}@media (min-width:768px){.ssk-sticky.ssk-left .ssk,.ssk-sticky.ssk-right .ssk{display:block;clear:both}.ssk-sticky.ssk-left.ssk-center,.ssk-sticky.ssk-right.ssk-center{top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%)}.ssk-sticky.ssk-left{left:0}.ssk-sticky.ssk-left .ssk{float:left}.ssk-sticky.ssk-left .ssk:hover{padding-left:15px}.ssk-sticky.ssk-right{right:0}.ssk-sticky.ssk-right .ssk{float:right}.ssk-sticky.ssk-right .ssk:hover{padding-right:15px}}.ssk-sticky.ssk-bottom{font-size:0;top:auto;bottom:0}.ssk-sticky.ssk-bottom.ssk-center{left:50%;right:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-moz-transform:translateX(-50%);-ms-transform:translateX(-50%);-o-transform:translateX(-50%)}.ssk-sticky.ssk-bottom .ssk{vertical-align:bottom}.ssk-sticky.ssk-bottom .ssk:hover{padding-bottom:15px}.ssk-sticky.ssk-round.ssk-xs .ssk:hover{padding:8px}.ssk-sticky.ssk-round.ssk-sm .ssk:hover{padding:9px}.ssk-sticky.ssk-round .ssk:hover{padding:11px}.ssk-sticky.ssk-round.ssk-lg .ssk:hover{padding:13px}@media (max-width:767px){.ssk-sticky{left:0;right:0;bottom:0;top:auto;width:100%;display:flex !important;flex-direction:row;flex-wrap:nowrap}.ssk-sticky.ssk-sticky-hide-xs{display:none !important}.ssk-sticky .ssk{flex:1;width:auto}.ssk-sticky .ssk .ssk-num{display:none}}.ssk-count{padding-top:20px}.ssk-count .ssk{position:relative}.ssk-count .ssk-num{border-radius:4px;color:#8f8f8f;background-color:rgba(50,50,50,0.03);display:block;font-size:12px;left:0;line-height:20px;position:absolute;right:0;text-align:center;top:-20px}@media (min-width:768px){.ssk-count.ssk-sticky{padding-top:0}.ssk-count.ssk-sticky.ssk-left .ssk-num,.ssk-count.ssk-sticky.ssk-right .ssk-num{top:20%;background-color:transparent}.ssk-count.ssk-sticky.ssk-left .ssk-num{left:100%;margin-left:5px}.ssk-count.ssk-sticky.ssk-right .ssk-num{right:115%;margin-left:-100%;text-align:right}}.ssk-facebook{background-color:#3B5998}.ssk-grayscale>.ssk-facebook{background-color:#757575}.ssk-facebook:hover{background-color:#2d4373}.ssk-facebook:hover{background-color:#2d4373}.ssk-grayscale>.ssk-facebook:hover{background-color:#3B5998}.ssk-facebook.ssk-icon{color:#3B5998}.ssk-facebook.ssk-icon:hover{color:#2d4373}.ssk-facebook.ssk-icon:before{text-indent:0;margin-right:0}.ssk-twitter{background-color:#1DA1F2}.ssk-grayscale>.ssk-twitter{background-color:#757575}.ssk-twitter:hover{background-color:#0c85d0}.ssk-twitter:hover{background-color:#0c85d0}.ssk-grayscale>.ssk-twitter:hover{background-color:#1DA1F2}.ssk-twitter.ssk-icon{color:#1DA1F2}.ssk-twitter.ssk-icon:hover{color:#0c85d0}.ssk-google-plus{background-color:#EA4335}.ssk-grayscale>.ssk-google-plus{background-color:#757575}.ssk-google-plus:hover{background-color:#d62516}.ssk-google-plus:hover{background-color:#d62516}.ssk-grayscale>.ssk-google-plus:hover{background-color:#EA4335}.ssk-google-plus.ssk-icon{color:#EA4335}.ssk-google-plus.ssk-icon:hover{color:#d62516}.ssk-pinterest{background-color:#BD081C}.ssk-grayscale>.ssk-pinterest{background-color:#757575}.ssk-pinterest:hover{background-color:#8c0615}.ssk-pinterest:hover{background-color:#8c0615}.ssk-grayscale>.ssk-pinterest:hover{background-color:#BD081C}.ssk-pinterest.ssk-icon{color:#BD081C}.ssk-pinterest.ssk-icon:hover{color:#8c0615}.ssk-tumblr{background-color:#395773}.ssk-grayscale>.ssk-tumblr{background-color:#757575}.ssk-tumblr:hover{background-color:#283d51}.ssk-tumblr:hover{background-color:#283d51}.ssk-grayscale>.ssk-tumblr:hover{background-color:#395773}.ssk-tumblr.ssk-icon{color:#395773}.ssk-tumblr.ssk-icon:hover{color:#283d51}.ssk-email{background-color:#757575}.ssk-grayscale>.ssk-email{background-color:#757575}.ssk-email:hover{background-color:#5b5b5b}.ssk-email:hover{background-color:#5b5b5b}.ssk-grayscale>.ssk-email:hover{background-color:#757575}.ssk-grayscale>.ssk-email:hover{background-color:#5b5b5b}.ssk-email.ssk-icon{color:#757575}.ssk-email.ssk-icon:hover{color:#5b5b5b}.ssk-vk{background-color:#54769a}.ssk-grayscale>.ssk-vk{background-color:#757575}.ssk-vk:hover{background-color:#425d79}.ssk-vk:hover{background-color:#425d79}.ssk-grayscale>.ssk-vk:hover{background-color:#54769a}.ssk-vk.ssk-icon{color:#54769a}.ssk-vk.ssk-icon:hover{color:#425d79}.ssk-linkedin{background-color:#1c87bd}.ssk-grayscale>.ssk-linkedin{background-color:#757575}.ssk-linkedin:hover{background-color:#156791}.ssk-linkedin:hover{background-color:#156791}.ssk-grayscale>.ssk-linkedin:hover{background-color:#1c87bd}.ssk-linkedin.ssk-icon{color:#1c87bd}.ssk-linkedin.ssk-icon:hover{color:#156791}.ssk-whatsapp{background-color:#34AF23}.ssk-grayscale>.ssk-whatsapp{background-color:#757575}.ssk-whatsapp:hover{background-color:#27851a}.ssk-whatsapp:hover{background-color:#27851a}.ssk-grayscale>.ssk-whatsapp:hover{background-color:#34AF23}.ssk-whatsapp.ssk-icon{color:#34AF23}.ssk-whatsapp.ssk-icon:hover{color:#27851a}.ssk-reddit{background-color:#5f99cf}.ssk-grayscale>.ssk-reddit{background-color:#757575}.ssk-reddit:hover{background-color:#3a80c1}.ssk-reddit:hover{background-color:#3a80c1}.ssk-grayscale>.ssk-reddit:hover{background-color:#5f99cf}.ssk-reddit.ssk-icon{color:#5f99cf}.ssk-reddit.ssk-icon:hover{color:#3a80c1}.ssk-reddit2{background-color:#5f99cf}.ssk-grayscale>.ssk-reddit2{background-color:#757575}.ssk-reddit2:hover{background-color:#3a80c1}.ssk-reddit2:hover{background-color:#3a80c1}.ssk-grayscale>.ssk-reddit2:hover{background-color:#5f99cf}.ssk-reddit2.ssk-icon{color:#5f99cf}.ssk-reddit2.ssk-icon:hover{color:#3a80c1}.ssk-turquoise{background-color:#1abc9c}.ssk-turquoise:hover{background-color:#148f77}.ssk-emerald{background-color:#2ecc71}.ssk-emerald:hover{background-color:#25a25a}.ssk-peter-river{background-color:#3498db}.ssk-peter-river:hover{background-color:#217dbb}.ssk-belize-hole{background-color:#2980b9}.ssk-belize-hole:hover{background-color:#20638f}.ssk-amethyst{background-color:#9b59b6}.ssk-amethyst:hover{background-color:#804399}.ssk-wisteria{background-color:#8e44ad}.ssk-wisteria:hover{background-color:#703688}.ssk-wet-asphalt{background-color:#34495e}.ssk-wet-asphalt:hover{background-color:#222f3d}.ssk-midnight-blue{background-color:#2c3e50}.ssk-midnight-blue:hover{background-color:#1a242f}.ssk-green-sea{background-color:#16a085}.ssk-green-sea:hover{background-color:#107360}.ssk-nephritis{background-color:#27ae60}.ssk-nephritis:hover{background-color:#1e8449}.ssk-sunflower{background-color:#f1c40f}.ssk-sunflower:hover{background-color:#c29d0b}.ssk-orange{background-color:#f39c12}.ssk-orange:hover{background-color:#c87f0a}.ssk-carrot{background-color:#e67e22}.ssk-carrot:hover{background-color:#bf6516}.ssk-pumpkin{background-color:#d35400}.ssk-pumpkin:hover{background-color:#a04000}.ssk-alizarin{background-color:#e74c3c}.ssk-alizarin:hover{background-color:#d62c1a}.ssk-pomegranate{background-color:#c0392b}.ssk-pomegranate:hover{background-color:#962d22}.ssk-clouds{background-color:#cfd9db}.ssk-clouds:hover{background-color:#b1c2c6}.ssk-concrete{background-color:#95a5a6}.ssk-concrete:hover{background-color:#798d8f}.ssk-silver{background-color:#bdc3c7}.ssk-silver:hover{background-color:#a1aab0}.ssk-asbestos{background-color:#7f8c8d}.ssk-asbestos:hover{background-color:#667273}.ssk-dark-gray{background-color:#555}.ssk-dark-gray:hover{background-color:#3b3b3b}.ssk-black{background-color:#333}.ssk-black:hover{background-color:#1a1a1a}
  </style>



  <style type="text/css" media="screen">
    a {
    color: #FFFFFF;
}

a:hover {
    color: #CB57E0;
}

body {
    background-color: #323131;
}

div.main .content .markdown h6 {
    color: #FFFFFF;
}

div.main .content .markdown, div.header .name, div.header nav ul {
    color: #FFFFFF;
    background-color: #323131;

}

div.header-home .container .content a .name h1 {
    text-decoration: none;
}
div .content {
    background-color: #323131;
}

div.header {
    background-color: #323131;
}
div.header nav ul a {
    color: #FFFFFF;
    background-color: #323131;
    text-decoration: none;
}
div.header nav ul a:hover {
  color: #CB57E0;
}

div.main .content .markdown code {
    background-color: #323131;
    color: #FFFFFF;
}

div.main .content .markdown figure {
    background: #323131;
}
div.main .content .markdown pre, div.main .content .markdown pre code {
   /* background-color: #323131;*/
   background-color: rgb(249, 252, 254);
    color: #87a5d2;
}



.hljs, .hljs-subst, .hljs-variable {
    color: #87a5d2;
}

.hljs-type {
    color: #97d28b;
}

.hljs-quote {
    color: #ffcb8d;
}

.hljs-string, .hljs-number, .hljs-selector-id, .hljs-selector-class, .hljs-template-tag, .hljs-deletion {
    color: #96c2d7;
}

.hljs-comment {
    color: #FFFFFF;
}

.hljs-regexp, .hljs-symbol, .hljs-template-variable {
    color: #ffcb8d;
}

.hljs-keyword, .hljs-attribute, .hljs-meta-keyword, .hljs-doctag, .hljs-name {
    color: #97d28b;
}

.hljs-link, .hljs-selector-attr, .hljs-selector-pseudo, .hljs-title, .hljs-section {
    color: #ff8e91;
}

.hljs-built_in, .hljs-bullet, .hljs-code, .hljs-addition {
    color: #97d28b;
}

.ssk {
    background-color: #FFFFFF;
    color: #CB57E0;
    a:hover {
        color: #CB57E0;
    }
}

  </style>





<link rel="shortcut icon"

    href="/img/antweiss.png"

>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-161003981-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>


<body>


<div class="header column">

    <div class="container">
        
        <a href="https://antweiss.com/"><img class="logo" src="https://avatars2.githubusercontent.com/u/3274734?s=40&amp;v=4" alt="logo"></a>
        
        <div class="content">
            <a href="/"><div class="name"><h1>one man&#39;s singularity</h1></div></a>
            <nav>
                <ul>
                    
                            <li><a href="/blog/">Blog</a></li>
                    
                    
                        
                            
                        
                    
                    
                        
                            <li><a href="/talks/">Talks</a></li>
                        
                    
                        
                    
                        
                            <li><a href="/about/">About</a></li>
                        
                    
                </ul>
            </nav>
        </div>
    </div>
</div>





<div class="main post non-narrow zero-top-spacing column">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    
    Exploring cgroups v2 and MemoryQoS With EKS and Bottlerocket
    

</div>

                </div>
                <div class="meta">
                    <div class="date" title="Sun Nov 12 2023 14:16:55 IST">Nov 12, 2023</div>
                    
                        
                    
                    
                    <div class="reading-time middot">8 minute read</div>
                    
                    
                      <div class="tags">
                    
                        <ul>
                          
                        </ul>
                    </div>
                    <div class="tags">
                        <ul>
                          
                          
                        </ul>
                    </div>
                </div>
            </div>
            <div class="markdown">
                
    
    <h1 id="aws-bottlerocket-and-cgroups-v2">AWS Bottlerocket and Cgroups V2</h1>
<p><img src="https://raw.githubusercontent.com/antweiss/botllerocket-cgroupv2/main/antweiss_bottlerocket_with_memory_d4aa3a97-258b-4267-bdd7-94660146c5d1.webp" alt="Blame Midjourney for this image">
Bottlerocket is a Linux-based operating system optimized for hosting containers. It was originally developed at AWS specifically for runnning secure and performant Kubernetes nodes. It&rsquo;s minimal, secure and supports atomic updates.</p>
<p>According to this <a href="https://github.com/Bottlerocket-os/Bottlerocket/discussions/2874">discussion</a> - starting with Bottlerocket 1.13.0 (Mar 2023) new distributions will default to using Cgroups v2 interface for process organization and enforcing resource limits.</p>
<p>In this post I intend to explore how this works for EKS clusters running Kubernetes 1.26+ and what this change means for EKS users.</p>
<h1 id="cgroups---an-intro">Cgroups - An Intro</h1>
<p>Cgroups (abbreviated from Control Groups) - is a Linux kernel feature that lies at the foundation of what we now know as Linux containers.</p>
<p>The feature allows to limit. account for and isolate resource usage for a collection of processes.</p>
<p>It was developed at Google circa 2007 and merged into Linux kernel mainline in 2008.</p>
<p><img src="https://wizardzines.com/images/uploads/cgroups.png" alt="Julia Evans&amp;rsquo; wonderful cgroups comic"></p>
<h2 id="cgroups-and-kubernetes">Cgroups and Kubernetes</h2>
<p>Kubernetes allows us to define resource usage for containers via the <a href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources">resources</a> map in the Pod API spec.
These definitions are then passed by the kubelet on to the container runtime on the node and translated into Cgroups configuration.</p>
<p>Up until version 1.25 Kubernetes only supported Cgroups v1 by default. In 1.25 - stable support for Cgroups v2 was added. Now if running on a node with Cgroups v2 - the kubelet automatically identifies this and perfroms accordingly. But what does this mean for our workload configuration? In order to understand that we need to explain what Cgroups v2 is.</p>
<h2 id="cgroups-v2">Cgroups V2</h2>
<p>Cgroups v2 was released in 2015 introducing API redesign - mainly for a unified hierarchy and improved consistency. The following diagram shows the change in how Cgroup controllers are ordered in v2 vs. v1:
<img src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*P7ZLLF_F4TMgGfaJ2XIfuQ.png" alt="cgroup hierarchy"></p>
<p>According to <a href="https://kubernetes.io/docs/concepts/architecture/cgroups/#:~:text=Some%20Kubernetes%20features%20exclusively%20use%20cgroup%20v2%20for%20enhanced%20resource%20management%20and%20isolation.%20For%20example%2C%20the%20MemoryQoS%20feature%20improves%20memory%20QoS%20and%20relies%20on%20cgroup%20v2%20primitives.">this architecture document</a> : <em>&ldquo;Some Kubernetes features exclusively use cgroup v2 for enhanced resource management and isolation. For example, the MemoryQoS feature improves memory QoS and relies on cgroup v2 primitives.&rdquo;</em></p>
<p>And when we look at the description of the aforementioned <em>MemoryQoS</em> feature we find out that &ldquo;In cgroup v1, and prior to this feature, the container runtime never took into account and effectively ignored spec.containers[].resources.requests[&ldquo;memory&rdquo;].&rdquo; and that &ldquo;Fortunately, cgroup v2 brings a new design and implementation to achieve full protection on memory&hellip; With this experimental feature, quality-of-service for pods and containers extends to cover not just CPU time but memory as well.&rdquo;</p>
<p>Well, first of all - <strong>it&rsquo;s a bit shocking and even insulting to learn that container runtimes ignored our settings</strong>! But I was also very curious to learn how this changes now that cgroups v2 support is introduced.</p>
<h2 id="memoryqos-and-cgroups-v2">MemoryQoS and Cgroups v2</h2>
<p>According to this <a href="https://kubernetes.io/blog/2021/11/26/qos-memory-resources/">page</a>:</p>
<p>Memory QoS uses the memory controller of cgroup v2 to guarantee memory resources in Kubernetes. Memory requests and limits of containers in pod are used to set specific interfaces <code>memory.min and </code>memory.high<code> provided by the memory controller. When `memory.min</code> is set to memory requests, memory resources are reserved and never reclaimed by the kernel; this is how Memory QoS ensures the availability of memory for Kubernetes pods. And if memory limits are set in the container, this means that the system needs to limit container memory usage, Memory QoS uses <code>memory.high</code> to throttle workload approaching it&rsquo;s memory limit, ensuring that the system is not overwhelmed by instantaneous memory allocation.
<img src="https://kubernetes.io/blog/2021/11/26/qos-memory-resources/memory-qos-cal.svg" alt="container memory in cgroup v2"></p>
<p>This is all great! Let&rsquo;s now provision an EKS cluster with some Bottlerocket nodes and see how this works in practice.</p>
<p>To easily spin up a cluster - use the <a href="https://github.com/antweiss/botllerocket-cgroupv2/blob/main/cluster.yaml">cluster.yaml</a> in the attached github repository:</p>
<p>generate ssh keys:</p>
<pre tabindex="0"><code>ssh-keygen -f ./mykey
</code></pre><p>and create the cluster</p>
<pre tabindex="0"><code>eksctl create cluster -f cluster.yaml
</code></pre><p>This will create a cluster with one Bottlerocket node. It also configures ssh access to the nodes by running the <a href="https://github.com/Bottlerocket-os/Bottlerocket-admin-container">Bottlerocket admin container</a>.</p>
<p>This means we can now access the node:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#388038">export</span> <span style="color:#b04040">NODE_IP</span><span style="color:#666">=</span><span style="color:#2838b0">$(</span>kubectl get node -oyaml <span style="color:#888">|</span> yq  <span style="color:#b83838">&#39;.items[].status.addresses[] | select(.type==&#34;ExternalIP&#34;) | .address&#39;</span><span style="color:#2838b0">)</span>
</span></span><span style="display:flex;"><span>ssh -i mykey ec2-user@<span style="color:#b04040">$NODE_IP</span>
</span></span></code></pre></div><p>We get greeted with the following screen:</p>
<p><img src="/img/Bottlerocket-ssh.png" alt=""></p>
<p>As this says - we can get admin access to the Bottlerocket filesystem by running <code>sudo sheltie</code>. So let&rsquo;s do that!</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">[</span>ec2-user@admin<span style="color:#666">]</span>$ sudo sheltie
</span></span><span style="display:flex;"><span><span style="color:#666">[</span>bash-5.1<span style="color:#666">]</span>$ whoami
</span></span><span style="display:flex;"><span>root
</span></span></code></pre></div><p>Now we can check if we in fact have <code>cgroupv2</code> enabled:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#666">[</span>bash-5.1<span style="color:#666">]</span>$ stat -fc %T /sys/fs/cgroup/
</span></span><span style="display:flex;"><span>cgroup2fs
</span></span></code></pre></div><p>Yup! This is cgroupv2! Were this <code>cgroupv1</code> the output would&rsquo;ve been <code>tmpfs</code>.</p>
<h2 id="lets-deploy-a-pod">Let&rsquo;s Deploy a Pod</h2>
<p>Ok, now let&rsquo;s deploy a pod to our node. We&rsquo;ll do that by creating a deployment based on the following <code>yaml</code> spec. This deploys [antweiss/busyhttp], that I forked from [jpetazzo/busyhttp] and add memory load and release endpoints to.
You&rsquo;ll notice that the pod runs a container with Guaranteed QoS - i.e memory and CPU limits are equal to requests:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#2838b0">apiVersion</span><span style="color:#888">:</span><span style="color:#a89028"> </span>apps/v1<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028"></span><span style="color:#2838b0">kind</span><span style="color:#888">:</span><span style="color:#a89028"> </span>Deployment<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028"></span><span style="color:#2838b0">metadata</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">labels</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">    </span><span style="color:#2838b0">app</span><span style="color:#888">:</span><span style="color:#a89028"> </span>busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">name</span><span style="color:#888">:</span><span style="color:#a89028"> </span>busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028"></span><span style="color:#2838b0">spec</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">replicas</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#444">1</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">selector</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">    </span><span style="color:#2838b0">matchLabels</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">      </span><span style="color:#2838b0">app</span><span style="color:#888">:</span><span style="color:#a89028"> </span>busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">template</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">    </span><span style="color:#2838b0">metadata</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">      </span><span style="color:#2838b0">labels</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">        </span><span style="color:#2838b0">app</span><span style="color:#888">:</span><span style="color:#a89028"> </span>busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">    </span><span style="color:#2838b0">spec</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">      </span><span style="color:#2838b0">containers</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">      </span>- <span style="color:#2838b0">image</span><span style="color:#888">:</span><span style="color:#a89028"> </span>otomato/busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">        </span><span style="color:#2838b0">name</span><span style="color:#888">:</span><span style="color:#a89028"> </span>busyhttp<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">        </span><span style="color:#2838b0">resources</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">          </span><span style="color:#2838b0">requests</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">            </span><span style="color:#2838b0">memory</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#b83838">&#34;200Mi&#34;</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">            </span><span style="color:#2838b0">cpu</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#b83838">&#34;250m&#34;</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">          </span><span style="color:#2838b0">limits</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">            </span><span style="color:#2838b0">memory</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#b83838">&#34;200Mi&#34;</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">            </span><span style="color:#2838b0">cpu</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#b83838">&#34;250m&#34;</span><span style="color:#a89028">
</span></span></span></code></pre></div><p>This spec is found in <a href="https://github.com/antweiss/botllerocket-cgroupv2/blob/main/dep.yaml">dep.yaml</a> and we can deploy it with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl apply -f dep.yaml
</span></span></code></pre></div><h2 id="check-the-cgroup-impact">Check the Cgroup Impact</h2>
<p>Now let&rsquo;s go back to our node and see how our resource definitions are reflected in the <code>cgroup</code> config.</p>
<p>Back inside the <code>sheltie</code> prompt let&rsquo;s explore the containers running on Bottlerocket. Bottlerocket OS is using <code>containerd</code> container runtime. In order to interact with it we&rsquo;ll need to use <a href="https://github.com/projectatomic/containerd/blob/master/docs/cli.md"><code>ctr</code></a>.</p>
<p>When we run <code>ctr help</code> - we get the following:</p>
<p><img src="/img/ctr.png" alt=""></p>
<p>So <code>ctr</code> is unsupported. A bit discouraging, but well, it&rsquo;s working. Let&rsquo;s try to look at our containers:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash-5.1$ ctr containers ls
</span></span><span style="display:flex;"><span>CONTAINER    IMAGE    RUNTIME
</span></span></code></pre></div><p>No containers?! But I do see my pod running on the node! Where is my container? Well the answer to that is <code>namespaces</code>. Yup, just like kubernetes or linux kernel - containerd has namespaces. And all the containers executed by the kubelet live in a namespace called &ldquo;k8s.io&rdquo;. We can see it by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash-5.1$ ctr ns ls
</span></span><span style="display:flex;"><span>NAME   LABELS
</span></span><span style="display:flex;"><span>k8s.io
</span></span></code></pre></div><p>Ok, let&rsquo;s check the containers in the &ldquo;k8s.io&rdquo; namespace:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash-5.1$ ctr -n k8s.io containers ls
</span></span><span style="display:flex;"><span>CONTAINER                                                           IMAGE                                                                                                RUNTIME
</span></span><span style="display:flex;"><span>0ed99eae66803896504d1853859d8866e00669b2610ba65cba6a17aa1300da48    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>154d9b7b3a83e4db6e3e4ac4ac1f836321337c604c3b590b5188b7a0773bdae1    docker.io/otomato/busyhttp:latest                                                                    io.containerd.runc.v2
</span></span><span style="display:flex;"><span>3b63efe56d15e9c315c668a5913e17ade420cf7fb5ff7fa62b3c9b0e1574eab4    112233445566.dkr.ecr.eu-central-1.amazonaws.com/amazon/aws-network-policy-agent:v1.0.7-eksbuild.1    io.containerd.runc.v2
</span></span><span style="display:flex;"><span>3c85fa3829f59f517db1c766e490a014357a760ce12e2859004cdfb8ea3d7cc6    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>420b62c7b2bdf2e7aa10baf8e4afd1ebda0cfff66300a23846758a029ad31222    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>4e21008f8fc70580906990fb95bed91f9155495270fbac1efb043f81e62a1c51    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/coredns:v1.11.1-eksbuild.4                       io.containerd.runc.v2
</span></span><span style="display:flex;"><span>4f9d20de851414160a5003eb6988f2b0df81dfe3d72d4ba3705db01a4571b515    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/kube-proxy:v1.29.0-minimal-eksbuild.1            io.containerd.runc.v2
</span></span><span style="display:flex;"><span>5f8924422d852d09ad44f5d8579d9abaa78304d303007d566300db8f61978ee5    112233445566.dkr.ecr.eu-central-1.amazonaws.com/amazon-k8s-cni:v1.16.0-eksbuild.1                    io.containerd.runc.v2
</span></span><span style="display:flex;"><span>7f5afdfbb9a8599c3c5888664f0df349aab8740be21d87e629ff7390e0524c2a    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>80ed8ba3fd4624770eb17087c1a046c90be28e9fb2e31630c82e67b4c0ae19dd    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>a0929884ccdd72de6bf848a037e80b206a4fb4e2f9b77be568bac8f51787cccb    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/pause:3.1-eksbuild.1                             io.containerd.runc.v2
</span></span><span style="display:flex;"><span>a0dd24ecb0aee4eb645d25c75a3eade0c8c35fb09127db5ff7d8136d7bb86efe    112233445566.dkr.ecr.eu-central-1.amazonaws.com/eks/coredns:v1.11.1-eksbuild.4                       io.containerd.runc.v2
</span></span><span style="display:flex;"><span>c3a3a9214b11b808a88c0293312d8877497f06f87435af3a7334717a13588c26    112233445566.dkr.ecr.eu-central-1.amazonaws.com/amazon-k8s-cni-init:v1.16.0-eksbuild.1               io.containerd.runc.v2
</span></span></code></pre></div><p>Now we&rsquo;re talking! We have all the usual suspects here - coredns, kube-proxy, the omnipresent <a href="https://docs.mirantis.com/mke/3.4/ref-arch/pause-containers.html">pause</a> containers. But right now we&rsquo;re interested in the container based on the <code>docker.io/otomato/busyhttp:latest</code> image.</p>
<p>Let&rsquo;s look for its cgroup definition in the cgroup filesystem we discovered previously. First we need to filter out the container id. <code>ctr</code> supports filters for its listing function. So the way to parse out the container id by image name is the following:</p>
<pre tabindex="0"><code>export CONTAINER_ID=$(ctr -n k8s.io containers ls -q image==docker.io/otomato/busyhttp:latest)
</code></pre><p>Note the <code>-q</code> that tells <code>ctr</code> to only output the id.</p>
<p>Now we can find the container&rsquo;s cgroup config:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find /sys/fs/cgroup/ -name *<span style="color:#b04040">$CONTAINER_ID</span>*
</span></span><span style="display:flex;"><span>/sys/fs/cgroup/kubepods.slice/kubepods-pod5be5d94a_cbfe_416f_9010_6338003af666.slice/cri-containerd-154d9b7b3a83e4db6e3e4ac4ac1f836321337c604c3b590b5188b7a0773bdae1.scope
</span></span></code></pre></div><p>This gives us a long path somewhere inside a folder called <code>kubepods.slice</code>. Let&rsquo;s wrap this path in an environment variable and look around:</p>
<pre tabindex="0"><code>export MY_CGROUP_DIR=$(find /sys/fs/cgroup/ -name *$CONTAINER_ID*)
ls ${MY_CGROUP_DIR}
</code></pre><p>Whew! That&rsquo;s a lot of files! Now according to <a href="https://kubernetes.io/blog/2021/11/26/qos-memory-resources/">this page on Memory QoS</a> - our <code>requests.memory</code> should be translated to <code>memory.min</code> while <code>memory.high</code> is calculated the following way:</p>
<pre tabindex="0"><code>memory,high = (pod.spec.containers[i].resources.limits[memory] or nodeAllocatableMemory) * throttlingFactor
</code></pre><p>Let&rsquo;s look at the limit first:</p>
<pre tabindex="0"><code>cat ${MY_CGROUP_DIR}/memory.high
max
</code></pre><p>Hmm. That&rsquo;s not a number. But we can also notice that there&rsquo;s a file called <code>memory.max</code>. Let&rsquo;s look inside that:</p>
<pre tabindex="0"><code>cat ${MY_CGROUP_DIR}/memory.high
209715200
</code></pre><p>Ok, here&rsquo;s our limit! 209715200 bytes is exactlymthe 200Mi we defined in the <code>resources</code> section of our pod spec.</p>
<p>Now what about the requests? Let&rsquo;s look at <code>memory.min</code>:</p>
<pre tabindex="0"><code>cat ${MY_CGROUP_DIR}/memory.min
0
</code></pre><p>0 is not the request we&rsquo;ve defined. And that makes sense. <a href="https://kubernetes.io/blog/2021/11/26/qos-memory-resources/">Memory QoS</a> has been in alpha since Kubernetes 1.22 (August 2021) and according to the <a href="https://github.com/kubernetes/enhancements/blob/master/keps/sig-node/2570-memory-qos/kep.yaml">KEP data</a> was still in alpha as of 1.27.</p>
<p>In order to see the actual request values for memory reflected in cgroup config one needs to enable the Memory QoS <a href="https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/#kubelet-config-k8s-io-v1beta1-KubeletConfiguration:~:text=effect.%20Default%3A%2015-,featureGates,-map%5Bstring%5Dbool">feature gate in kubelet config</a> as defined <a href="https://github.com/kubernetes/kubernetes/blob/master/pkg/features/kube_features.go#L492">here</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#2838b0">apiVersion</span><span style="color:#888">:</span><span style="color:#a89028"> </span>kubelet.config.k8s.io/v1beta1<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028"></span><span style="color:#2838b0">kind</span><span style="color:#888">:</span><span style="color:#a89028"> </span>KubeletConfiguration<span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028"></span><span style="color:#2838b0">featureGates</span><span style="color:#888">:</span><span style="color:#a89028">
</span></span></span><span style="display:flex;"><span><span style="color:#a89028">  </span><span style="color:#2838b0">MamoryQoS</span><span style="color:#888">:</span><span style="color:#a89028"> </span><span style="color:#444;font-style:italic">true</span><span style="color:#a89028">
</span></span></span></code></pre></div><p>Trouble is - due to the atomic nature of Bottlerocket OS - we can&rsquo;t change its KubeletConfiguration file (found at /etc/kubernetes/kubelet/config) directly. We can only pass settings through <code>settings.kubernetes</code> via the API or a config file. But these currently don&rsquo;t support setting feature gates. So it looks like the only way to modify the Kubelet to support Memory QoS on EKS Bottlerocket nodes is to build our own Bottlerocket images. Which is a subject for a whole another blog post.</p>
<p>And for now - let&rsquo;s shrug our shoulders, scratch our heads and bring down our EKS cluster:</p>
<pre tabindex="0"><code>eksctl delete cluster -f cluster.yaml
</code></pre><h2 id="summing-it-all-up">Summing it All Up</h2>
<ul>
<li>
<p><code>cgroup v2</code> is enabled by default in current Bottlerocket EKS instances.</p>
</li>
<li>
<p>this allows a better organized resource management on the nodes</p>
</li>
<li>
<p>an important Kubernetes feature based on <code>cgroup v2</code> is Memory QoS that ensure that memory requests are actually allocated by the container runtime and not merely checked for by the Kubernetes scheduler</p>
</li>
<li>
<p>MemoryQoS is still in <code>alpha</code> after 2 years</p>
</li>
<li>
<p>There&rsquo;s no easy way to enable Memory QoS on Bottlerocket nodes without building the AMIs ourselves.</p>
</li>
</ul>
<p>Anyway - this was an interesting exploration. And if there&rsquo;s anything I got wrong or didn&rsquo;t make clear - please let me know in comments.</p>
<p>May all your containers run smoothly!</p>
<p>The config files used in the blog post can be found <a href="https://github.com/antweiss/botllerocket-cgroupv2">in this github repo</a></p>


            </div>
            
            <br>
            <div class="share">
                  
                  <a href="" class="ssk ssk-facebook"></a>
                  
                  
                  <a href="" class="ssk ssk-twitter"></a>
                  
                  
                  <a href="" class="ssk ssk-google-plus"></a>
                  
                  
                  <a href="" class="ssk ssk-linkedin"></a>
                  
            </div>
            
            
            <br>
            <div class="navigation">
                
                <div>
                    <img class="icon" src="/img/back.svg" alt="back" />
                    <a href="https://antweiss.com/blog/devops-shorts-23-hila-fish/">Devops Shorts 23 Hila Fish</a>
                </div>
                
                <div style="width: 100%;"></div>
                
                <div>
                    <a href="https://antweiss.com/blog/devops-shorts-24-henrik-hoegh/">Devops Shorts 24 Henrik Hoegh</a>
                    <img class="icon" src="/img/next.svg" alt="next" />
                </div>
                
            </div>
            
            
            <br>
            <div class="disqus">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "antweiss" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            

            
            

            

            
        </div>
    </div>
</div>



<div class="footer column">
    <div class="container">

        

        

        <div class="copyright">

        

        </div>
        <div class="icons">

        

        

        

        

        

        

        
            <a href="https://github.com/antweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/github.svg" alt="github" />
            </a>
        

        
            <a href="https://twitter.com/antweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/twitter.svg" alt="twitter" />
            </a>
        

        
            <a href="https://www.linkedin.com/in/antonweiss" rel=me target="_blank">
                <img class="icon" src="https://antweiss.com/img/linkedin.svg" alt="linkedin" />
            </a>
        

        

        

        
            <a href="mailto:anton@otomato.io">
                <img class="icon" src="https://antweiss.com/img/email.svg" alt="email" />
            </a>
        

        
            <a href="https://antweiss.com/index.xml">
                <img class="icon" src="https://antweiss.com/img/rss.svg" alt="rss" />
            </a>
        

        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Raleway:400,600,700', 'Merriweather:300,300i,700,700i', 'Ubuntu+Mono:400,700']
    }
  });
</script>



  <script src="https://antweiss.com/js/highlight.min.js" defer></script>
  



  <script src="https://antweiss.com/js/progressively.min.js" defer></script>



  <script src="https://antweiss.com/js/social-share-kit.min.js" defer></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-161003981-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script>
  window.onload = function() {
    
      hljs.initHighlighting();
    
    
      progressively.init({delay: 30, throttle: 50});
    
    
      SocialShareKit.init({
        twitter: {
            text: '',
            via: 'antweiss'
        }
      });
    
  };
</script>




</body>
</html>

